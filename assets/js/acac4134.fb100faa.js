"use strict";(self.webpackChunkstaticdocs_starter=self.webpackChunkstaticdocs_starter||[]).push([[2435],{15680:(a,e,t)=>{t.r(e),t.d(e,{MDXContext:()=>l,MDXProvider:()=>c,mdx:()=>x,useMDXComponents:()=>d,withMDXComponents:()=>o});var n=t(96540);function m(a,e,t){return e in a?Object.defineProperty(a,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):a[e]=t,a}function s(){return s=Object.assign||function(a){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(a[n]=t[n])}return a},s.apply(this,arguments)}function r(a,e){var t=Object.keys(a);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(a);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(a,e).enumerable}))),t.push.apply(t,n)}return t}function p(a){for(var e=1;e<arguments.length;e++){var t=null!=arguments[e]?arguments[e]:{};e%2?r(Object(t),!0).forEach((function(e){m(a,e,t[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(t)):r(Object(t)).forEach((function(e){Object.defineProperty(a,e,Object.getOwnPropertyDescriptor(t,e))}))}return a}function i(a,e){if(null==a)return{};var t,n,m=function(a,e){if(null==a)return{};var t,n,m={},s=Object.keys(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||(m[t]=a[t]);return m}(a,e);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(a);for(n=0;n<s.length;n++)t=s[n],e.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(a,t)&&(m[t]=a[t])}return m}var l=n.createContext({}),o=function(a){return function(e){var t=d(e.components);return n.createElement(a,s({},e,{components:t}))}},d=function(a){var e=n.useContext(l),t=e;return a&&(t="function"==typeof a?a(e):p(p({},e),a)),t},c=function(a){var e=d(a.components);return n.createElement(l.Provider,{value:e},a.children)},N={inlineCode:"code",wrapper:function(a){var e=a.children;return n.createElement(n.Fragment,{},e)}},h=n.forwardRef((function(a,e){var t=a.components,m=a.mdxType,s=a.originalType,r=a.parentName,l=i(a,["components","mdxType","originalType","parentName"]),o=d(t),c=m,h=o["".concat(r,".").concat(c)]||o[c]||N[c]||s;return t?n.createElement(h,p(p({ref:e},l),{},{components:t})):n.createElement(h,p({ref:e},l))}));function x(a,e){var t=arguments,m=e&&e.mdxType;if("string"==typeof a||m){var s=t.length,r=new Array(s);r[0]=h;var p={};for(var i in e)hasOwnProperty.call(e,i)&&(p[i]=e[i]);p.originalType=a,p.mdxType="string"==typeof a?a:m,r[1]=p;for(var l=2;l<s;l++)r[l]=t[l];return n.createElement.apply(null,r)}return n.createElement.apply(null,t)}h.displayName="MDXCreateElement"},73631:(a,e,t)=>{t.r(e),t.d(e,{assets:()=>i,contentTitle:()=>r,default:()=>d,frontMatter:()=>s,metadata:()=>p,toc:()=>l});var n=t(58168),m=(t(96540),t(15680));const s={id:"poststratify",title:"Post-Stratification",description:"Post-Stratification",sidebar_position:3,keywords:["Post-Stratification","poststratify"]},r=void 0,p={unversionedId:"docs/statistical_methods/poststratify",id:"docs/statistical_methods/poststratify",title:"Post-Stratification",description:"Post-Stratification",source:"@site/docs/docs/statistical_methods/poststratify.md",sourceDirName:"docs/statistical_methods",slug:"/docs/statistical_methods/poststratify",permalink:"/docs/docs/statistical_methods/poststratify",draft:!1,editUrl:"https://github.com/facebookresearch/balance/tree/main/website/docs/docs/statistical_methods/poststratify.md",tags:[],version:"current",sidebarPosition:3,frontMatter:{id:"poststratify",title:"Post-Stratification",description:"Post-Stratification",sidebar_position:3,keywords:["Post-Stratification","poststratify"]},sidebar:"docsSidebar",previous:{title:"Covariate Balancing Propensity Score",permalink:"/docs/docs/statistical_methods/cbps"},next:{title:"Raking",permalink:"/docs/docs/statistical_methods/rake"}},i={},l=[{value:"Introduction",id:"introduction",level:2},{value:"Methodology",id:"methodology",level:2},{value:"Examples",id:"examples",level:2},{value:"Matching a single variable",id:"matching-a-single-variable",level:3},{value:"Matching the joint distribution of two variables",id:"matching-the-joint-distribution-of-two-variables",level:3},{value:"References",id:"references",level:2}],o={toc:l};function d(a){let{components:e,...t}=a;return(0,m.mdx)("wrapper",(0,n.A)({},o,t,{components:e,mdxType:"MDXLayout"}),(0,m.mdx)("h2",{id:"introduction"},"Introduction"),(0,m.mdx)("p",null,"Post-stratification is one of the most common weighing approaches in survey statistics. It origins from a stratified sample, where the population is divided into subpopulations (strata) and the sample is conducted independently on each of them. However, when one doesn't know in advance the subpopulations to sample from (for example, when the stratum of the units in the sample is unknown in advance), or when non-response is presented, stratification can be done after the sample has been selected."),(0,m.mdx)("p",null,"The goal of post-stratification is to have the sample match exactly the joint-distribution of the target population. However, this is also the main limitation of this method. It is limited by the number of variables we are able to use for adjustment due to the nature of fitting the target exactly, and thus require a minimal number of respondent in each strata. Hence, usually at most 2 to 4 variables are used (with limited number of buckets). In addition, continues variables cannot be used for adjustment (unless bucketed). A more general approach is the inverse propensity score weighting (",(0,m.mdx)("a",{parentName:"p",href:"../ipw"},"ipw"),")."),(0,m.mdx)("h2",{id:"methodology"},"Methodology"),(0,m.mdx)("p",null,"The idea behind post-stratification is simple. For each cell (strata) in the population, compute the percent of the total population in this cell. Then fit weights so that they adjust the sample so to have the same proportions for each strata as in the population."),(0,m.mdx)("p",null,"We will illustrate this with an example. Assume that we have sampled people from a certain population to a survey and asked for their age and gender so to use these for weighing. Assume also that the joint distribution of age and gender in this population is known from a census, and is the following:"),(0,m.mdx)("table",null,(0,m.mdx)("thead",{parentName:"table"},(0,m.mdx)("tr",{parentName:"thead"},(0,m.mdx)("th",{parentName:"tr",align:null}),(0,m.mdx)("th",{parentName:"tr",align:null},"Young adults"),(0,m.mdx)("th",{parentName:"tr",align:null},"Adults"),(0,m.mdx)("th",{parentName:"tr",align:null},"Total"))),(0,m.mdx)("tbody",{parentName:"table"},(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Female"),(0,m.mdx)("td",{parentName:"tr",align:null},"120"),(0,m.mdx)("td",{parentName:"tr",align:null},"380"),(0,m.mdx)("td",{parentName:"tr",align:null},"500")),(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Male"),(0,m.mdx)("td",{parentName:"tr",align:null},"80"),(0,m.mdx)("td",{parentName:"tr",align:null},"420"),(0,m.mdx)("td",{parentName:"tr",align:null},"500")),(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Total"),(0,m.mdx)("td",{parentName:"tr",align:null},"200"),(0,m.mdx)("td",{parentName:"tr",align:null},"800"),(0,m.mdx)("td",{parentName:"tr",align:null},"1000")))),(0,m.mdx)("p",null,"In addition, assume that for the specific survey we ran young adults tend to reply more, so that the distribution of responses in the survey is the following:"),(0,m.mdx)("table",null,(0,m.mdx)("thead",{parentName:"table"},(0,m.mdx)("tr",{parentName:"thead"},(0,m.mdx)("th",{parentName:"tr",align:null}),(0,m.mdx)("th",{parentName:"tr",align:null},"Young adults"),(0,m.mdx)("th",{parentName:"tr",align:null},"Adults"),(0,m.mdx)("th",{parentName:"tr",align:null},"Total"))),(0,m.mdx)("tbody",{parentName:"table"},(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Female"),(0,m.mdx)("td",{parentName:"tr",align:null},"30"),(0,m.mdx)("td",{parentName:"tr",align:null},"10"),(0,m.mdx)("td",{parentName:"tr",align:null},"40")),(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Male"),(0,m.mdx)("td",{parentName:"tr",align:null},"50"),(0,m.mdx)("td",{parentName:"tr",align:null},"10"),(0,m.mdx)("td",{parentName:"tr",align:null},"60")),(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Total"),(0,m.mdx)("td",{parentName:"tr",align:null},"80"),(0,m.mdx)("td",{parentName:"tr",align:null},"20"),(0,m.mdx)("td",{parentName:"tr",align:null},"100")))),(0,m.mdx)("p",null,"The post-stratification weights are then computed as follows:"),(0,m.mdx)("ul",null,(0,m.mdx)("li",{parentName:"ul"},"Proportion of Female young adults in the population is ",(0,m.mdx)("span",{parentName:"li",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"120"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"1000"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"0.12")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"120/1000 = 0.12")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"120/1000"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.12")))))),(0,m.mdx)("li",{parentName:"ul"},"Proportion of Female young adults in the sample is ",(0,m.mdx)("span",{parentName:"li",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"30"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"100"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"0.3")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"30/100 = 0.3")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"30/100"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.3"))))))),(0,m.mdx)("p",null,"Inflation factor - this is the inverse probability factor indicating by how much we need to multiply the total sample size to get to the total population size. It is equal to population size / sample size. In our case it is: ",(0,m.mdx)("span",{parentName:"p",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"1000"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"100"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"10")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"1000/100 = 10")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"1000/100"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"10"))))),"."),(0,m.mdx)("p",null,"Calculate weights for each Female young adult in the sample: (population %) / (sample %) ",(0,m.mdx)("em",{parentName:"p"}," (inflation factor). In our example this is: $0.12/0.3 ")," 10= 0.4 * 10= 4$."),(0,m.mdx)("p",null,"This means that the assigned weight of each Female young adult in the sample is 4."),(0,m.mdx)("p",null,"Similarly, we can compute the weight for people from each cell in the table:"),(0,m.mdx)("table",null,(0,m.mdx)("thead",{parentName:"table"},(0,m.mdx)("tr",{parentName:"thead"},(0,m.mdx)("th",{parentName:"tr",align:null}),(0,m.mdx)("th",{parentName:"tr",align:null},"Young adults"),(0,m.mdx)("th",{parentName:"tr",align:null},"Adults"))),(0,m.mdx)("tbody",{parentName:"table"},(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Female"),(0,m.mdx)("td",{parentName:"tr",align:null},(0,m.mdx)("span",{parentName:"td",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"0.12"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"0.3"),(0,m.mdx)("mo",{parentName:"mrow"},"\u2217"),(0,m.mdx)("mn",{parentName:"mrow"},"10"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"4")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"0.12/0.3 * 10 = 4")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.12/0.3"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,m.mdx)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"10"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"4")))))),(0,m.mdx)("td",{parentName:"tr",align:null},(0,m.mdx)("span",{parentName:"td",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"0.38"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"0.1"),(0,m.mdx)("mo",{parentName:"mrow"},"\u2217"),(0,m.mdx)("mn",{parentName:"mrow"},"10"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"38")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"0.38/0.1 * 10 = 38")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.38/0.1"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,m.mdx)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"10"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"38"))))))),(0,m.mdx)("tr",{parentName:"tbody"},(0,m.mdx)("td",{parentName:"tr",align:null},"Male"),(0,m.mdx)("td",{parentName:"tr",align:null},(0,m.mdx)("span",{parentName:"td",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"0.08"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"0.5"),(0,m.mdx)("mo",{parentName:"mrow"},"\u2217"),(0,m.mdx)("mn",{parentName:"mrow"},"10"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"1.6")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"0.08/0.5 * 10 = 1.6")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.08/0.5"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,m.mdx)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"10"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"1.6")))))),(0,m.mdx)("td",{parentName:"tr",align:null},(0,m.mdx)("span",{parentName:"td",className:"math math-inline"},(0,m.mdx)("span",{parentName:"span",className:"katex"},(0,m.mdx)("span",{parentName:"span",className:"katex-mathml"},(0,m.mdx)("math",{parentName:"span",xmlns:"http://www.w3.org/1998/Math/MathML"},(0,m.mdx)("semantics",{parentName:"math"},(0,m.mdx)("mrow",{parentName:"semantics"},(0,m.mdx)("mn",{parentName:"mrow"},"0.42"),(0,m.mdx)("mi",{parentName:"mrow",mathvariant:"normal"},"/"),(0,m.mdx)("mn",{parentName:"mrow"},"0.1"),(0,m.mdx)("mo",{parentName:"mrow"},"\u2217"),(0,m.mdx)("mn",{parentName:"mrow"},"10"),(0,m.mdx)("mo",{parentName:"mrow"},"="),(0,m.mdx)("mn",{parentName:"mrow"},"42")),(0,m.mdx)("annotation",{parentName:"semantics",encoding:"application/x-tex"},"0.42/0.1 *10 = 42")))),(0,m.mdx)("span",{parentName:"span",className:"katex-html","aria-hidden":"true"},(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"1em",verticalAlign:"-0.25em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"0.42/0.1"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}}),(0,m.mdx)("span",{parentName:"span",className:"mbin"},"\u2217"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2222em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"10"),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}}),(0,m.mdx)("span",{parentName:"span",className:"mrel"},"="),(0,m.mdx)("span",{parentName:"span",className:"mspace",style:{marginRight:"0.2778em"}})),(0,m.mdx)("span",{parentName:"span",className:"base"},(0,m.mdx)("span",{parentName:"span",className:"strut",style:{height:"0.6444em"}}),(0,m.mdx)("span",{parentName:"span",className:"mord"},"42"))))))))),(0,m.mdx)("h2",{id:"examples"},"Examples"),(0,m.mdx)("p",null,"Below are two short code examples that show how to run ",(0,m.mdx)("inlineCode",{parentName:"p"},"balance.weighting_methods.poststratify")," on the simulated data shipped\nwith the package. They rely on ",(0,m.mdx)("inlineCode",{parentName:"p"},"balance.load_data")," so you can copy-paste the\ncells into a notebook, or refer to the new\n",(0,m.mdx)("a",{parentName:"p",href:"https://import-balance.org/docs/tutorials/quickstart_poststratify/"},"post-stratification tutorial"),"."),(0,m.mdx)("blockquote",null,(0,m.mdx)("p",{parentName:"blockquote"},(0,m.mdx)("strong",{parentName:"p"},"Tip:")," For clarity we drop rows where any of the adjustment variables are\nmissing, because the default ",(0,m.mdx)("inlineCode",{parentName:"p"},"strict_matching=True")," requires that every\ncombination observed in the sample also appears in the target data.")),(0,m.mdx)("h3",{id:"matching-a-single-variable"},"Matching a single variable"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-python"},'import pandas as pd\nfrom balance import load_data\nfrom balance.weighting_methods.poststratify import poststratify\n\ntarget_df, sample_df = load_data()\n\nsample_gender = sample_df.dropna(subset=["gender"])\ntarget_gender = target_df.dropna(subset=["gender"])\n\nresult = poststratify(\n    sample_df=sample_gender[["gender"]],\n    sample_weights=pd.Series(1, index=sample_gender.index),\n    target_df=target_gender[["gender"]],\n    target_weights=pd.Series(1, index=target_gender.index),\n)\n\nweighted = sample_gender.assign(weight=result["weight"])\ndisplay(weighted.groupby("gender")["weight"].sum())\n')),(0,m.mdx)("p",null,"The grouped sum reproduces the target population counts (because we pass unit\ndesign weights): each gender sums to ",(0,m.mdx)("inlineCode",{parentName:"p"},"4551")," in this dataset. You can divide\nby the total weight to recover the target proportions."),(0,m.mdx)("h3",{id:"matching-the-joint-distribution-of-two-variables"},"Matching the joint distribution of two variables"),(0,m.mdx)("pre",null,(0,m.mdx)("code",{parentName:"pre",className:"language-python"},'covariates = ["gender", "age_group"]\nsample_cells = sample_df.dropna(subset=covariates)\ntarget_cells = target_df.dropna(subset=covariates)\n\nresult = poststratify(\n    sample_df=sample_cells[covariates],\n    sample_weights=pd.Series(1, index=sample_cells.index),\n    target_df=target_cells[covariates],\n    target_weights=pd.Series(1, index=target_cells.index),\n)\n\nweighted = sample_cells.assign(weight=result["weight"])\ndisplay(weighted.groupby(covariates)["weight"].sum().unstack())\n')),(0,m.mdx)("p",null,"This second example uses the same two categorical variables but keeps their\njoint cells intact. The pivoted table matches the census counts for each cell\n(e.g. ",(0,m.mdx)("inlineCode",{parentName:"p"},"Female")," aged ",(0,m.mdx)("inlineCode",{parentName:"p"},"25-34")," totals ",(0,m.mdx)("inlineCode",{parentName:"p"},"1360")," and ",(0,m.mdx)("inlineCode",{parentName:"p"},"Male")," aged ",(0,m.mdx)("inlineCode",{parentName:"p"},"18-24"),"\ntotals ",(0,m.mdx)("inlineCode",{parentName:"p"},"905"),"). Unlike raking, which iteratively matches the marginal\ndistributions of each variable, ",(0,m.mdx)("inlineCode",{parentName:"p"},"poststratify")," calculates weights per cell so\nthat the final weighted sample matches the full two-dimensional distribution."),(0,m.mdx)("h2",{id:"references"},"References"),(0,m.mdx)("ul",null,(0,m.mdx)("li",{parentName:"ul"},"More about post-stratification: ",(0,m.mdx)("a",{parentName:"li",href:"https://docs.wfp.org/api/documents/WFP-0000121326/download/"},"Introduction to post-stratification")),(0,m.mdx)("li",{parentName:"ul"},"Kolenikov, Stas. 2016. \u201cPost-Stratification or Non-Response Adjustment?\u201d Survey Practice 9 (3). ",(0,m.mdx)("a",{parentName:"li",href:"https://doi.org/10.29115/SP-2016-0014"},"https://doi.org/10.29115/SP-2016-0014"),".")))}d.isMDXComponent=!0}}]);