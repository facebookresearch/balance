<!DOCTYPE html>

<html lang="en" data-content_root="../../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>balance.balancedf_class &#8212; balance  documentation</title>
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/basic.css?v=eeb27264" />
    <script src="../../_static/documentation_options.js?v=5929fcd5"></script>
    <script src="../../_static/doctools.js?v=888ff710"></script>
    <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
  </head><body>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">balance  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../balance.html" accesskey="U">balance</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">balance.balancedf_class</a></li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body" role="main">
            
  <h1>Source code for balance.balancedf_class</h1><div class="highlight"><pre>
<span></span><span class="c1"># Copyright (c) Meta Platforms, Inc. and affiliates.</span>
<span class="c1">#</span>
<span class="c1"># This software may be used and distributed according to the terms of the</span>
<span class="c1"># GNU General Public License version 2.</span>

<span class="c1"># pyre-unsafe</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Literal</span><span class="p">,</span> <span class="n">Optional</span><span class="p">,</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">Union</span>

<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">plotly.graph_objs</span> <span class="k">as</span> <span class="nn">go</span>
<span class="kn">from</span> <span class="nn">balance</span> <span class="kn">import</span> <span class="n">util</span> <span class="k">as</span> <span class="n">balance_util</span>
<span class="kn">from</span> <span class="nn">balance.adjustment</span> <span class="kn">import</span> <span class="n">trim_weights</span>
<span class="kn">from</span> <span class="nn">balance.sample_class</span> <span class="kn">import</span> <span class="n">Sample</span>
<span class="kn">from</span> <span class="nn">balance.stats_and_plots</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">general_stats</span><span class="p">,</span>
    <span class="n">weighted_comparisons_plots</span><span class="p">,</span>
    <span class="n">weighted_comparisons_stats</span><span class="p">,</span>
    <span class="n">weighted_stats</span><span class="p">,</span>
    <span class="n">weights_stats</span><span class="p">,</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">balance.typing</span> <span class="kn">import</span> <span class="n">FilePathOrBuffer</span>
<span class="kn">from</span> <span class="nn">balance.util</span> <span class="kn">import</span> <span class="n">find_items_index_in_list</span><span class="p">,</span> <span class="n">get_items_from_list_via_indices</span>

<span class="kn">from</span> <span class="nn">IPython.lib.display</span> <span class="kn">import</span> <span class="n">FileLink</span>

<span class="n">logger</span><span class="p">:</span> <span class="s2">&quot;logging.Logger&quot;</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="n">__package__</span><span class="p">)</span>


<div class="viewcode-block" id="BalanceDF">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF">[docs]</a>
<span class="k">class</span> <span class="nc">BalanceDF</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Wrapper class around a Sample which provides additional balance-specific functionality</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">_model_matrix</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">sample</span><span class="p">:</span> <span class="n">Sample</span><span class="p">,</span>
        <span class="n">name</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;outcomes&quot;</span><span class="p">,</span> <span class="s2">&quot;weights&quot;</span><span class="p">,</span> <span class="s2">&quot;covars&quot;</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A basic init method used by BalanceOutcomesDF,BalanceCovarsDF, and BalanceWeightsDF</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): The object that is initiated.</span>
<span class="sd">            df (pd.DataFrame): a df from a sample object.</span>
<span class="sd">            sample (Sample): A sample object to be stored as reference.</span>
<span class="sd">            name (Literal[&quot;outcomes&quot;, &quot;weights&quot;, &quot;covars&quot;]): The type of object that will be created. In practice, used for &quot;outcomes&quot;, &quot;weights&quot; and &quot;covars&quot;.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: double underscore helps to add friction so that users do not change these objects.</span>
        <span class="c1">#       see details here: https://stackoverflow.com/a/1301369/256662</span>
        <span class="c1"># TODO: when refactoring the object class model, re-evaluate if we want to keep such objects protected or not.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__sample</span> <span class="o">=</span> <span class="n">sample</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__df</span> <span class="o">=</span> <span class="n">df</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__name</span> <span class="o">=</span> <span class="n">name</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="n">name</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span>
        <span class="n">sample</span> <span class="o">=</span> <span class="nb">object</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">()</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2"> from </span><span class="si">{</span><span class="n">sample</span><span class="si">}</span><span class="s2">:</span><span class="se">\n</span><span class="si">{</span><span class="n">df</span><span class="si">}</span><span class="s2">&quot;</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;(</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__module__</span><span class="si">}</span><span class="s2">.</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__qualname__</span><span class="si">}</span><span class="s2">)</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="fm">__str__</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
        <span class="p">)</span>

    <span class="c1">#  Private API</span>
    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_check_if_not_BalanceDF</span><span class="p">(</span>
        <span class="n">BalanceDF_class_obj</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">object_name</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;sample_BalanceDF&quot;</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Check if an object is BalanceDF, if not then it raises ValueError</span>

<span class="sd">        Args:</span>
<span class="sd">            BalanceDF_class_obj (BalanceDF): Object to check.</span>
<span class="sd">            object_name (str, optional): Object name (to use when raising the ValueError). Defaults to &quot;sample_BalanceDF&quot;.</span>

<span class="sd">        Returns: None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: if BalanceDF_class_obj is not BalanceDF object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">BalanceDF_class_obj</span><span class="p">,</span> <span class="n">BalanceDF</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">object_name</span><span class="si">}</span><span class="s2"> must be balancedf_class.BalanceDF, is </span><span class="si">{</span><span class="nb">type</span><span class="p">(</span><span class="n">BalanceDF_class_obj</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="p">)</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_sample</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;Sample&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access __sample internal object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Sample: __sample</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__sample</span>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Access the weight_column in __sample.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[pd.DataFrame]: The weights (with no column name)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">w</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="o">.</span><span class="n">weight_column</span>
        <span class="k">return</span> <span class="n">w</span><span class="o">.</span><span class="n">rename</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span>

    <span class="c1"># NOTE: only in the case of BalanceOutcomesDF can it result in a None value.</span>
    <span class="k">def</span> <span class="nf">_BalanceDF_child_from_linked_samples</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span>
        <span class="nb">str</span><span class="p">,</span>
        <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BalanceCovarsDF&quot;</span><span class="p">,</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="s2">&quot;BalanceOutcomesDF&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">]],</span>
    <span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns a dict with self and the same type of BalanceDF_child when created from the linked samples.</span>

<span class="sd">        For example, if this function is called from a BalanceCovarsDF (originally created using `Sample.covars()`),</span>
<span class="sd">        that was invoked by a Sample with a target then the return dict will have the keys &#39;self&#39; and &#39;target&#39;,</span>
<span class="sd">        with the BalanceCovarsDF of the self and that of the target.</span>

<span class="sd">        If the object has nothing but self, then it will be a dict with only one key:value pair (of self).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object (used in practice only with children of BalanceDF).</span>


<span class="sd">        Returns:</span>
<span class="sd">            Dict[str, Union[&quot;BalanceCovarsDF&quot;, &quot;BalanceWeightsDF&quot;, Union[&quot;BalanceOutcomesDF&quot;, None]],]:</span>
<span class="sd">            A dict mapping the link relationship to the result.</span>
<span class="sd">                First item is self, and it just returns it without using method on it.</span>
<span class="sd">                The other items are based on the objects in _links. E.g.: it can be &#39;target&#39;</span>
<span class="sd">                and &#39;unadjusted&#39;, and it will return them after running the same BalanceDF child creation method on them.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>
<span class="sd">                from balance.sample_class import Sample</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>


<span class="sd">                # keys depends on which samples are linked to the object:</span>
<span class="sd">                list(s1.covars()._BalanceDF_child_from_linked_samples().keys())  # [&#39;self&#39;]</span>
<span class="sd">                list(s3.covars()._BalanceDF_child_from_linked_samples().keys())  # [&#39;self&#39;, &#39;target&#39;]</span>
<span class="sd">                list(s3_null.covars()._BalanceDF_child_from_linked_samples().keys())  # [&#39;self&#39;, &#39;target&#39;, &#39;unadjusted&#39;]</span>

<span class="sd">                # Indeed, all are of the same BalanceDF child type:</span>
<span class="sd">                s3.covars()._BalanceDF_child_from_linked_samples()</span>
<span class="sd">                # {&#39;self&#39;: (balance.balancedf_class.BalanceCovarsDF)</span>
<span class="sd">                # covars from &lt;balance.sample_class.Sample object at 0x7f4392ea61c0&gt;:</span>
<span class="sd">                #     a   b  c</span>
<span class="sd">                # 0  1 -42  x</span>
<span class="sd">                # 1  2   8  y</span>
<span class="sd">                # 2  3   2  z</span>
<span class="sd">                # 3  1 -42  v,</span>
<span class="sd">                # &#39;target&#39;: (balance.balancedf_class.BalanceCovarsDF)</span>
<span class="sd">                # covars from &lt;balance.sample_class.Sample object at 0x7f43958fbd90&gt;:</span>
<span class="sd">                #     a  b  c</span>
<span class="sd">                # 0  1  4  x</span>
<span class="sd">                # 1  2  6  y</span>
<span class="sd">                # 2  3  8  z}</span>

<span class="sd">                s3_null.covars()._BalanceDF_child_from_linked_samples()</span>
<span class="sd">                # {&#39;self&#39;: (balance.balancedf_class.BalanceCovarsDF)</span>
<span class="sd">                # covars from &lt;balance.sample_class.Sample object at 0x7f4392ea60d0&gt;:</span>
<span class="sd">                #     a   b  c</span>
<span class="sd">                # 0  1 -42  x</span>
<span class="sd">                # 1  2   8  y</span>
<span class="sd">                # 2  3   2  z</span>
<span class="sd">                # 3  1 -42  v,</span>
<span class="sd">                # &#39;target&#39;: (balance.balancedf_class.BalanceCovarsDF)</span>
<span class="sd">                # covars from &lt;balance.sample_class.Sample object at 0x7f43958fbd90&gt;:</span>
<span class="sd">                #     a  b  c</span>
<span class="sd">                # 0  1  4  x</span>
<span class="sd">                # 1  2  6  y</span>
<span class="sd">                # 2  3  8  z,</span>
<span class="sd">                # &#39;unadjusted&#39;: (balance.balancedf_class.BalanceCovarsDF)</span>
<span class="sd">                # covars from &lt;balance.sample_class.Sample object at 0x7f4392ea61c0&gt;:</span>
<span class="sd">                #     a   b  c</span>
<span class="sd">                # 0  1 -42  x</span>
<span class="sd">                # 1  2   8  y</span>
<span class="sd">                # 2  3   2  z</span>
<span class="sd">                # 3  1 -42  v}</span>

<span class="sd">                the_dict = s3_null.covars()._BalanceDF_child_from_linked_samples()</span>
<span class="sd">                [v.__class__ for (k,v) in the_dict.items()]</span>
<span class="sd">                [balance.balancedf_class.BalanceCovarsDF,</span>
<span class="sd">                balance.balancedf_class.BalanceCovarsDF,</span>
<span class="sd">                balance.balancedf_class.BalanceCovarsDF]</span>


<span class="sd">                # This also works for outcomes (returns None if there is none):</span>
<span class="sd">                s3.outcomes()._BalanceDF_child_from_linked_samples()</span>
<span class="sd">                # {&#39;self&#39;: (balance.balancedf_class.BalanceOutcomesDF)</span>
<span class="sd">                #  outcomes from &lt;balance.sample_class.Sample object at 0x7f4392ea61c0&gt;:</span>
<span class="sd">                #      o</span>
<span class="sd">                #  0   7</span>
<span class="sd">                #  1   8</span>
<span class="sd">                #  2   9</span>
<span class="sd">                #  3  10,</span>
<span class="sd">                #  &#39;target&#39;: None}</span>

<span class="sd">                # And also works for weights:</span>
<span class="sd">                s3.weights()._BalanceDF_child_from_linked_samples()</span>
<span class="sd">                # {&#39;self&#39;: (balance.balancedf_class.BalanceWeightsDF)</span>
<span class="sd">                #  weights from &lt;balance.sample_class.Sample object at 0x7f4392ea61c0&gt;:</span>
<span class="sd">                #       w</span>
<span class="sd">                #  0  0.5</span>
<span class="sd">                #  1  2.0</span>
<span class="sd">                #  2  1.0</span>
<span class="sd">                #  3  1.0,</span>
<span class="sd">                #  &#39;target&#39;: (balance.balancedf_class.BalanceWeightsDF)</span>
<span class="sd">                #  weights from &lt;balance.sample_class.Sample object at 0x7f43958fbd90&gt;:</span>
<span class="sd">                #       w</span>
<span class="sd">                #  0  0.5</span>
<span class="sd">                #  1  1.0</span>
<span class="sd">                #  2  2.0}</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># NOTE: this assumes that the .__name is the same as the creation method (i.e.: .covars(), .weights(), .outcomes())</span>
        <span class="n">BalanceDF_child_method</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">__name</span>
        <span class="n">d</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>
        <span class="n">d</span><span class="o">.</span><span class="n">update</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="n">k</span><span class="p">:</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">BalanceDF_child_method</span><span class="p">)()</span>
                <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="o">.</span><span class="n">_links</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="p">}</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">d</span>  <span class="c1"># pyre-fixme[7]: this returns what&#39;s declared `Dict[str, Union[BalanceCovarsDF, BalanceOutcomesDF, BalanceWeightsDF]]` but got `Dict[str, BalanceDF]`</span>

    <span class="k">def</span> <span class="nf">_call_on_linked</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">method</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">exclude</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">Tuple</span><span class="p">]</span> <span class="o">=</span> <span class="p">(),</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Call a given method on the linked DFs of the BalanceDF object.</span>
<span class="sd">        Returns the result as a pandas DataFrame where the source column</span>
<span class="sd">        indicates where the result came from</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            method (str): A name of a method to call (e.g.: &quot;mean&quot;, &quot;std&quot;, etc.).</span>
<span class="sd">                Can also be a name of an attribute that is a DataFrame (e.g.: &#39;df&#39;)</span>
<span class="sd">            exclude (Tuple[str], optional): A tuple of strings which indicates which source should be excluded from the output. Defaults to ().</span>
<span class="sd">                E.g.: &quot;self&quot;, &quot;target&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A pandas DataFrame where the source column</span>
<span class="sd">                indicates where the result came from. E.g.: &#39;self&#39;, &#39;target&#39;, &#39;unadjusted&#39;.</span>
<span class="sd">                And the columns are based on the method called. E.g.: using mean will give the</span>
<span class="sd">                per column mean, after applying `model_matrix` to the df from each object.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                from balance.sample_class import Sample</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>

<span class="sd">                print(s3.covars()._call_on_linked(&quot;mean&quot;).round(3))</span>
<span class="sd">                    #             a       b   c[v]   c[x]   c[y]   c[z]</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self    1.889 -10.000  0.222  0.111  0.444  0.222</span>
<span class="sd">                    # target  2.429   6.857    NaN  0.143  0.286  0.571</span>

<span class="sd">                print(s3.covars()._call_on_linked(&quot;df&quot;).round(3))</span>
<span class="sd">                    #         a   b  c</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self    1 -42  x</span>
<span class="sd">                    # self    2   8  y</span>
<span class="sd">                    # self    3   2  z</span>
<span class="sd">                    # self    1 -42  v</span>
<span class="sd">                    # target  1   4  x</span>
<span class="sd">                    # target  2   6  y</span>
<span class="sd">                    # target  3   8  z</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">output</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span> <span class="ow">and</span> <span class="n">k</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">exclude</span><span class="p">:</span>
                <span class="n">v_att_method</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">method</span><span class="p">)</span>
                <span class="k">if</span> <span class="nb">callable</span><span class="p">(</span><span class="n">v_att_method</span><span class="p">):</span>
                    <span class="n">v_att_method</span> <span class="o">=</span> <span class="n">v_att_method</span><span class="p">(</span>
                        <span class="n">on_linked_samples</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
                    <span class="p">)</span>
                <span class="n">output</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">v_att_method</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">source</span><span class="o">=</span><span class="n">k</span><span class="p">)</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;source&quot;</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span><span class="n">output</span><span class="p">)</span>

        <span class="c1"># return pd.concat(</span>
        <span class="c1">#     getattr(v, method)(on_linked_samples=False, *args, **kwargs)</span>
        <span class="c1">#     .assign(source=k)</span>
        <span class="c1">#     .set_index(&quot;source&quot;)</span>
        <span class="c1">#     if callable(getattr(v, method))</span>
        <span class="c1">#     else getattr(v, method)(on_linked_samples=False, *args, **kwargs)</span>
        <span class="c1">#     .assign(source=k)</span>
        <span class="c1">#     .set_index(&quot;source&quot;)</span>
        <span class="c1">#     for k, v in self._BalanceDF_child_from_linked_samples().items()</span>
        <span class="c1">#     if v is not None and k not in exclude</span>
        <span class="c1"># )</span>

    <span class="c1"># TODO: add the ability to pass formula argument to model_matrix</span>
    <span class="c1">#       but in which case - notice that we&#39;d want the ability to track</span>
    <span class="c1">#       which object is stored in _model_matrix (and to run it over)</span>
    <span class="c1">#       Also, the output may sometimes no longer only be pd.DataFrame</span>
    <span class="c1">#       so such work will require update the type hinting here.</span>
<div class="viewcode-block" id="BalanceDF.model_matrix">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.model_matrix">[docs]</a>
    <span class="k">def</span> <span class="nf">model_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Return a model_matrix version of the df inside the BalanceDF object using balance_util.model_matrix</span>

<span class="sd">        This can be used to turn all character columns into a one hot encoding columns.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The output from :func:`balance_util.model_matrix`</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                print(s1.covars().df)</span>
<span class="sd">                    # a   b  c</span>
<span class="sd">                    # 0  1 -42  x</span>
<span class="sd">                    # 1  2   8  y</span>
<span class="sd">                    # 2  3   2  z</span>
<span class="sd">                    # 3  1 -42  v</span>

<span class="sd">                print(s1.covars().model_matrix())</span>
<span class="sd">                    #      a     b  c[v]  c[x]  c[y]  c[z]</span>
<span class="sd">                    # 0  1.0 -42.0   0.0   1.0   0.0   0.0</span>
<span class="sd">                    # 1  2.0   8.0   0.0   0.0   1.0   0.0</span>
<span class="sd">                    # 2  3.0   2.0   0.0   0.0   0.0   1.0</span>
<span class="sd">                    # 3  1.0 -42.0   1.0   0.0   0.0   0.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">hasattr</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="s2">&quot;_model_matrix&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_matrix</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_model_matrix</span> <span class="o">=</span> <span class="n">balance_util</span><span class="o">.</span><span class="n">model_matrix</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">add_na</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">return_type</span><span class="o">=</span><span class="s2">&quot;one&quot;</span>
            <span class="p">)[</span><span class="s2">&quot;model_matrix&quot;</span><span class="p">]</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_model_matrix</span></div>


    <span class="k">def</span> <span class="nf">_descriptive_stats</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">stat</span><span class="p">:</span> <span class="n">Literal</span><span class="p">[</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="s2">&quot;var_of_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;ci_of_mean&quot;</span><span class="p">,</span> <span class="s2">&quot;...&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;mean&quot;</span><span class="p">,</span>
        <span class="n">weighted</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">numeric_only</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">add_na</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calls a given method from :func:`weighted_stats.descriptive_stats` on &#39;self&#39;.</span>
<span class="sd">        This function knows how to extract the df and the weights from a BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): An object to run stats on.</span>
<span class="sd">            stat (Literal[&quot;mean&quot;, &quot;std&quot;, &quot;var_of_mean&quot;, &quot;ci_of_mean&quot;, &quot;...&quot;], optional): Defaults to &quot;mean&quot;.</span>
<span class="sd">            weighted (bool, optional): Defaults to True.</span>
<span class="sd">            numeric_only (bool, optional): Defaults to False.</span>
<span class="sd">            add_na (bool, optional): Defaults to True.</span>
<span class="sd">            **kwargs: extra args to pass to descriptive_stats</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: Returns pd.DataFrame of the output (based on stat argument), for each of the columns in df.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">numeric_only</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">number</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_matrix</span><span class="p">()</span>

        <span class="n">weights</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="p">(</span><span class="n">weighted</span> <span class="ow">and</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="p">)</span>
        <span class="n">wdf</span> <span class="o">=</span> <span class="n">weighted_stats</span><span class="o">.</span><span class="n">descriptive_stats</span><span class="p">(</span>
            <span class="n">df</span><span class="p">,</span>
            <span class="n">weights</span><span class="p">,</span>
            <span class="n">stat</span><span class="p">,</span>
            <span class="n">weighted</span><span class="o">=</span><span class="n">weighted</span><span class="p">,</span>
            <span class="c1"># Using numeric_only=True since we know that df is screened in this function</span>
            <span class="c1"># To only include numeric variables. So this saves descriptive_stats from</span>
            <span class="c1"># running model_matrix again.</span>
            <span class="n">numeric_only</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">add_na</span><span class="o">=</span><span class="n">add_na</span><span class="p">,</span>
            <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">wdf</span>

<div class="viewcode-block" id="BalanceDF.to_download">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.to_download">[docs]</a>
    <span class="k">def</span> <span class="nf">to_download</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">tempdir</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">FileLink</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a downloadable link of the DataFrame, with ids, of the BalanceDF object.</span>

<span class="sd">        File name starts with tmp_balance_out_, and some random file name (using :func:`uuid.uuid4`).</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            tempdir (Optional[str], optional): Defaults to None (which then uses a temporary folder using :func:`tempfile.gettempdir`).</span>

<span class="sd">        Returns:</span>
<span class="sd">            FileLink: Embedding a local file link in an IPython session, based on path. Using :func:FileLink.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">balance_util</span><span class="o">.</span><span class="n">_to_download</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_df_with_ids</span><span class="p">(),</span> <span class="n">tempdir</span><span class="p">)</span></div>


    <span class="c1">#  Public API</span>
    <span class="c1">#  All these functions operate on multiple samples</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">df</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Get the df of the BalanceDF object.</span>

<span class="sd">        The df is stored in the BalanceDF.__df object, that is set during the __init__ of the object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): The object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: The df (this is __df, with no weights) from the BalanceDF object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">__df</span>

<div class="viewcode-block" id="BalanceDF.names">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.names">[docs]</a>
    <span class="k">def</span> <span class="nf">names</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Returns the column names of the DataFrame (df) inside a BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): The object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List: Of column names.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s1.covars().names()</span>
<span class="sd">                # [&#39;a&#39;, &#39;b&#39;, &#39;c&#39;]</span>
<span class="sd">                s1.weights().names()</span>
<span class="sd">                # [&#39;w&#39;]</span>
<span class="sd">                s1.outcomes().names()</span>
<span class="sd">                # [&#39;o&#39;]</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceDF.plot">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots the variables in the df of the BalanceDF object.</span>

<span class="sd">        See :func:`weighted_comparisons_plots.plot_dist` for details of various arguments that can be passed.</span>
<span class="sd">        The default plotting engine is plotly, but seaborn can be used for static plots.</span>

<span class="sd">        This function is inherited as is when invoking BalanceCovarsDF.plot, but some modifications are made when</span>
<span class="sd">        preparing the data for BalanceOutcomesDF.plot and BalanceWeightsDF.plot.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object (used in the plots as &quot;sample&quot; or &quot;self&quot;)</span>
<span class="sd">            on_linked_samples (bool, optional): Determines if the linked samples should be included in the plot.</span>
<span class="sd">                Defaults to True.</span>
<span class="sd">            **kwargs: passed to :func:`weighted_comparisons_plots.plot_dist`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[Union[List, np.ndarray], Dict[str, go.Figure], None]:</span>
<span class="sd">                If library=&quot;plotly&quot; then returns a dictionary containing plots if return_dict_of_figures is True. None otherwise.</span>
<span class="sd">                If library=&quot;seaborn&quot; then returns None, unless return_axes is True. Then either a list or an np.array of matplotlib axis.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                from numpy import random</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                random.seed(96483)</span>

<span class="sd">                df = pd.DataFrame({</span>
<span class="sd">                    &quot;id&quot;: range(100),</span>
<span class="sd">                    &#39;v1&#39;: random.random_integers(11111, 11114, size=100).astype(str),</span>
<span class="sd">                    &#39;v2&#39;: random.normal(size = 100),</span>
<span class="sd">                    &#39;v3&#39;: random.uniform(size = 100),</span>
<span class="sd">                    &quot;w&quot;: pd.Series(np.ones(99).tolist() + [1000]),</span>
<span class="sd">                }).sort_values(by=[&#39;v2&#39;])</span>

<span class="sd">                s1 = Sample.from_frame(df,</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    df.assign(w = pd.Series(np.ones(100))),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>
<span class="sd">                s3_null.set_weights(random.random(size = 100) + 0.5)</span>

<span class="sd">                s3_null.covars().plot()</span>
<span class="sd">                s3_null.covars().plot(library = &quot;seaborn&quot;)</span>

<span class="sd">                # Controlling the limits of the y axis using lim:</span>
<span class="sd">                s3_null.covars().plot(ylim = (0,1))</span>
<span class="sd">                s3_null.covars().plot(library = &quot;seaborn&quot;,ylim = (0,1), dist_type = &quot;hist&quot;)</span>

<span class="sd">                # Returning plotly qq plots:</span>
<span class="sd">                s3_null.covars().plot(dist_type = &quot;qq&quot;)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="n">dfs_to_add</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">dfs_to_add</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;self&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="p">}</span>

        <span class="c1"># Create a list of dicts, each dict representing a dataframe and weights</span>
        <span class="c1"># Notice that we skip cases in which there is no data (i.e.: v is None)</span>
        <span class="c1"># None values are skipped in both dfs and names</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="p">[</span>
            <span class="p">{</span><span class="s2">&quot;df&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="s2">&quot;weight&quot;</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">_weights</span><span class="p">}</span>
            <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dfs_to_add</span><span class="o">.</span><span class="n">items</span><span class="p">()</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="n">k</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">dfs_to_add</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="p">(</span><span class="n">v</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)]</span>

        <span class="c1"># re-order dfs and names</span>
        <span class="c1"># NOTE: &quot;target&quot;, if exists, is placed at the end of the dict so that comparative plotting functions,</span>
        <span class="n">indices_of_ordered_names</span> <span class="o">=</span> <span class="n">find_items_index_in_list</span><span class="p">(</span>
            <span class="n">names</span><span class="p">,</span> <span class="p">[</span><span class="s2">&quot;unadjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;self&quot;</span><span class="p">,</span> <span class="s2">&quot;adjusted&quot;</span><span class="p">,</span> <span class="s2">&quot;target&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">dfs</span> <span class="o">=</span> <span class="n">get_items_from_list_via_indices</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">indices_of_ordered_names</span><span class="p">)</span>
        <span class="n">names</span> <span class="o">=</span> <span class="n">get_items_from_list_via_indices</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">indices_of_ordered_names</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">weighted_comparisons_plots</span><span class="o">.</span><span class="n">plot_dist</span><span class="p">(</span><span class="n">dfs</span><span class="p">,</span> <span class="n">names</span><span class="o">=</span><span class="n">names</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


    <span class="c1">#  NOTE: The following functions use the _call_on_linked method</span>
    <span class="c1">#        to return information about the characteristics of linked Samples</span>
<div class="viewcode-block" id="BalanceDF.mean">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.mean">[docs]</a>
    <span class="k">def</span> <span class="nf">mean</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a weighted mean on the df of the BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            on_linked_samples (bool, optional): Should the calculation be on self AND the linked samples objects? Defaults to True.</span>
<span class="sd">                If True, then uses :func:`_call_on_linked` with method &quot;mean&quot;.</span>
<span class="sd">                If False, then uses :func:`_descriptive_stats` with method &quot;mean&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                With row per object: self if on_linked_samples=False, and self and others (e.g.: target and unadjusted) if True.</span>
<span class="sd">                Columns are for each of the columns in the relevant df (after applying :func:`model_matrix`)</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                print(s3_null.covars().mean())</span>

<span class="sd">                #                 a          b      c[v]      c[x]      c[y]      c[z]</span>
<span class="sd">                # source</span>
<span class="sd">                # self        1.888889 -10.000000  0.222222  0.111111  0.444444  0.222222</span>
<span class="sd">                # target      2.428571   6.857143       NaN  0.142857  0.285714  0.571429</span>
<span class="sd">                # unadjusted  1.888889 -10.000000  0.222222  0.111111  0.444444  0.222222</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_on_linked</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_descriptive_stats</span><span class="p">(</span><span class="s2">&quot;mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceDF.std">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.std">[docs]</a>
    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a weighted std on the df of the BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            on_linked_samples (bool, optional): Should the calculation be on self AND the linked samples objects? Defaults to True.</span>
<span class="sd">                If True, then uses :func:`_call_on_linked` with method &quot;std&quot;.</span>
<span class="sd">                If False, then uses :func:`_descriptive_stats` with method &quot;std&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                With row per object: self if on_linked_samples=False, and self and others (e.g.: target and unadjusted) if True.</span>
<span class="sd">                Columns are for each of the columns in the relevant df (after applying :func:`model_matrix`)</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                print(s3_null.covars().std())</span>

<span class="sd">                    #                 a          b  c[v]      c[x]      c[y]      c[z]</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self        0.886405  27.354812   0.5  0.377964  0.597614  0.500000</span>
<span class="sd">                    # target      0.963624   1.927248   NaN  0.462910  0.597614  0.654654</span>
<span class="sd">                    # unadjusted  0.886405  27.354812   0.5  0.377964  0.597614  0.500000</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_on_linked</span><span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_descriptive_stats</span><span class="p">(</span><span class="s2">&quot;std&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceDF.var_of_mean">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.var_of_mean">[docs]</a>
    <span class="k">def</span> <span class="nf">var_of_mean</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a variance of the weighted mean on the df of the BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            on_linked_samples (bool, optional): Should the calculation be on self AND the linked samples objects? Defaults to True.</span>
<span class="sd">                If True, then uses :func:`_call_on_linked` with method &quot;var_of_mean&quot;.</span>
<span class="sd">                If False, then uses :func:`_descriptive_stats` with method &quot;var_of_mean&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                With row per object: self if on_linked_samples=False, and self and others (e.g.: target and unadjusted) if True.</span>
<span class="sd">                Columns are for each of the columns in the relevant df (after applying :func:`model_matrix`)</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>
<span class="sd">                from balance.stats_and_plots.weighted_stats import var_of_weighted_mean</span>

<span class="sd">                var_of_weighted_mean(pd.Series((1, 2, 3, 1)), pd.Series((0.5, 2, 1, 1)))</span>
<span class="sd">                    # 0    0.112178</span>
<span class="sd">                    # dtype: float64</span>
<span class="sd">                # This shows we got the first cell of &#39;a&#39; as expected.</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                print(s3_null.covars().var_of_mean())</span>
<span class="sd">                    #                    a           b      c[v]      c[x]      c[y]      c[z]</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self        0.112178  134.320988  0.042676  0.013413  0.082914  0.042676</span>
<span class="sd">                    # target      0.163265    0.653061       NaN  0.023324  0.069971  0.093294</span>
<span class="sd">                    # unadjusted  0.112178  134.320988  0.042676  0.013413  0.082914  0.042676</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_on_linked</span><span class="p">(</span><span class="s2">&quot;var_of_mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_descriptive_stats</span><span class="p">(</span><span class="s2">&quot;var_of_mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceDF.ci_of_mean">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.ci_of_mean">[docs]</a>
    <span class="k">def</span> <span class="nf">ci_of_mean</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates a confidence intervals of the weighted mean on the df of the BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            on_linked_samples (bool, optional): Should the calculation be on self AND the linked samples objects? Defaults to True.</span>
<span class="sd">                If True, then uses :func:`_call_on_linked` with method &quot;ci_of_mean&quot;.</span>
<span class="sd">                If False, then uses :func:`_descriptive_stats` with method &quot;ci_of_mean&quot;.</span>
<span class="sd">            kwargs: we can pass ci_of_mean arguments. E.g.: conf_level and round_ndigits.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                With row per object: self if on_linked_samples=False, and self and others (e.g.: target and unadjusted) if True.</span>
<span class="sd">                Columns are for each of the columns in the relevant df (after applying :func:`model_matrix`)</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>
<span class="sd">                from balance.stats_and_plots.weighted_stats import ci_of_weighted_mean</span>

<span class="sd">                ci_of_weighted_mean(pd.Series((1, 2, 3, 1)), pd.Series((0.5, 2, 1, 1)), round_ndigits = 3)</span>
<span class="sd">                # 0    (1.232, 2.545)</span>
<span class="sd">                # dtype: object</span>
<span class="sd">                # This shows we got the first cell of &#39;a&#39; as expected.</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                print(s3_null.covars().ci_of_mean(round_ndigits = 3).T)</span>
<span class="sd">                    # source               self           target         unadjusted</span>
<span class="sd">                    # a          (1.232, 2.545)   (1.637, 3.221)     (1.232, 2.545)</span>
<span class="sd">                    # b       (-32.715, 12.715)   (5.273, 8.441)  (-32.715, 12.715)</span>
<span class="sd">                    # c[v]      (-0.183, 0.627)              NaN    (-0.183, 0.627)</span>
<span class="sd">                    # c[x]      (-0.116, 0.338)  (-0.156, 0.442)    (-0.116, 0.338)</span>
<span class="sd">                    # c[y]       (-0.12, 1.009)  (-0.233, 0.804)     (-0.12, 1.009)</span>
<span class="sd">                    # c[z]      (-0.183, 0.627)   (-0.027, 1.17)    (-0.183, 0.627)</span>

<span class="sd">                s3_2 = s1.set_target(s2)</span>
<span class="sd">                s3_null_2 = s3_2.adjust(method=&quot;null&quot;)</span>
<span class="sd">                print(s3_null_2.outcomes().ci_of_mean(round_ndigits = 3))</span>
<span class="sd">                    #                         o</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self        (7.671, 9.44)</span>
<span class="sd">                    # unadjusted  (7.671, 9.44)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_call_on_linked</span><span class="p">(</span><span class="s2">&quot;ci_of_mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_descriptive_stats</span><span class="p">(</span><span class="s2">&quot;ci_of_mean&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceDF.mean_with_ci">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.mean_with_ci">[docs]</a>
    <span class="k">def</span> <span class="nf">mean_with_ci</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">round_ndigits</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a table with means and confidence intervals (CIs) for all elements in the BalanceDF object.</span>

<span class="sd">        This method calculates the mean and CI for each column of the BalanceDF object using the BalanceDF.mean()</span>
<span class="sd">        and BalanceDF.ci_of_mean() methods, respectively. The resulting table contains (for each element such as self, target and adjust) two columns for each input</span>
<span class="sd">        column: one for the mean and one for the CI.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): The BalanceDF object.</span>
<span class="sd">            round_ndigits (int, optional): The number of decimal places to round the mean and CI to.</span>
<span class="sd">                Defaults to 3.</span>
<span class="sd">            on_linked_samples (bool, optional): A boolean indicating whether to include linked samples</span>
<span class="sd">                when calculating the mean. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A table with two rows for each input column: one for the mean and one for the CI.</span>
<span class="sd">                The columns of the table are labeled with the names of the input columns.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>
<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame({&quot;o1&quot;: (7, 8, 9, 10), &quot;o2&quot;: (7, 8, 9, np.nan), &quot;id&quot;: (1, 2, 3, 4)}),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>

<span class="sd">                t_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;o1&quot;: (7, 8, 9, 10, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;o2&quot;: (7, 8, 9, np.nan, np.nan, 12, 13, 14),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4, 5, 6, 7, 8),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>
<span class="sd">                s_o2 = s_o.set_target(t_o)</span>

<span class="sd">                print(s_o2.outcomes().mean_with_ci())</span>
<span class="sd">                    # source            self  target             self           target</span>
<span class="sd">                    # _is_na_o2[False]  0.75   0.750   (0.326, 1.174)     (0.45, 1.05)</span>
<span class="sd">                    # _is_na_o2[True]   0.25   0.250  (-0.174, 0.674)    (-0.05, 0.55)</span>
<span class="sd">                    # o1                8.50  10.500   (7.404, 9.596)  (8.912, 12.088)</span>
<span class="sd">                    # o2                6.00   7.875   (2.535, 9.465)  (4.351, 11.399)</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">the_means</span> <span class="o">=</span> <span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">on_linked_samples</span><span class="o">=</span><span class="n">on_linked_samples</span><span class="p">)</span><span class="o">.</span><span class="n">round</span><span class="p">(</span><span class="n">round_ndigits</span><span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="p">)</span>
        <span class="n">the_cis</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ci_of_mean</span><span class="p">(</span>
            <span class="n">on_linked_samples</span><span class="o">=</span><span class="n">on_linked_samples</span><span class="p">,</span> <span class="n">round_ndigits</span><span class="o">=</span><span class="n">round_ndigits</span>
        <span class="p">)</span><span class="o">.</span><span class="n">T</span>
        <span class="n">the_cis</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">the_cis</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;_ci&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">the_means</span><span class="p">,</span> <span class="n">the_cis</span><span class="p">],</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span></div>


    <span class="c1"># NOTE: Summary could return also an str in case it is overridden in other children&#39;s methods.</span>
<div class="viewcode-block" id="BalanceDF.summary">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.summary">[docs]</a>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns a summary of the BalanceDF object.</span>

<span class="sd">        This method currently calculates the mean and confidence interval (CI) for each column of the object</span>
<span class="sd">        using the :func:`BalanceDF.mean_with_ci()` method. In the future, this method may be extended to include additional</span>
<span class="sd">        summary statistics.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): The BalanceDF object.</span>
<span class="sd">            on_linked_samples (bool, optional): A boolean indicating whether to include linked samples</span>
<span class="sd">                when calculating the mean and CI. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[pd.DataFrame, str]: A table with two rows for each input column: one for the mean and one for the CI.</span>
<span class="sd">                The columns of the table are labeled with the names of the input columns.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO model matrix means to include categorical columns, fix model_matrix to accept DataFrame</span>
        <span class="c1"># TODO: include min/max/std/etc. show min/mean/max if there&#39;s a single column, just means if multiple (covars and outcomes)</span>
        <span class="c1">#       Doing so would either require to implement a min/max etc methods in BalanceDF and use them with _call_on_linked.</span>
        <span class="c1">#       Or, update _call_on_linked to deal with non functions, get &#39;df&#39; from it, and apply the needed functions on it.</span>
        <span class="c1"># TODO add outcome variance ratio</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_with_ci</span><span class="p">(</span><span class="n">on_linked_samples</span><span class="o">=</span><span class="n">on_linked_samples</span><span class="p">)</span></div>


    <span class="k">def</span> <span class="nf">_get_df_and_weights</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">Optional</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Extract covars df (after using model_matrix) and weights from a BalanceDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object</span>

<span class="sd">        Returns:</span>
<span class="sd">            Tuple[pd.DataFrame, Optional[np.ndarray]]:</span>
<span class="sd">                A pd.DataFrame output from running :func:`model_matrix`, and</span>
<span class="sd">                A np.ndarray of weights from :func:`_weights`, or just None (if there are no weights).</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># get df values (like in BalanceDF._descriptive_stats)</span>
        <span class="n">df_model_matrix</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">model_matrix</span><span class="p">()</span>
        <span class="c1"># get weights (like in BalanceDF._descriptive_stats)</span>
        <span class="n">weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_weights</span><span class="o">.</span><span class="n">values</span> <span class="k">if</span> <span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_weights</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">)</span> <span class="k">else</span> <span class="kc">None</span>
        <span class="k">return</span> <span class="n">df_model_matrix</span><span class="p">,</span> <span class="n">weights</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">_asmd_BalanceDF</span><span class="p">(</span>
        <span class="n">sample_BalanceDF</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">target_BalanceDF</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">aggregate_by_main_covar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Run asmd on two BalanceDF objects</span>

<span class="sd">        Prepares the BalanceDF objects by passing them through :func:`_get_df_and_weights`, and</span>
<span class="sd">        then pass the df and weights from the two objects into :func:`weighted_comparisons_stats.asmd`.</span>

<span class="sd">        Note that this will works on the result of model_matrix (default behavior, no formula supplied),</span>
<span class="sd">        which is different than just the raw covars. E.g.: in case there are nulls (will produce an indicator column of that),</span>
<span class="sd">        as well as if there are categorical variables (transforming them using one hot encoding).</span>

<span class="sd">        Args:</span>
<span class="sd">            sample_df (BalanceDF): Object</span>
<span class="sd">            target_df (BalanceDF): Object</span>
<span class="sd">            aggregate_by_main_covar (bool, optional): See :func:`weighted_comparisons_stats.asmd`. Defaults to False.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.Series: See :func:`weighted_comparisons_stats.asmd`</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                from balance.balancedf_class import BalanceDF</span>

<span class="sd">                BalanceDF._asmd_BalanceDF(</span>
<span class="sd">                    Sample.from_frame(</span>
<span class="sd">                        pd.DataFrame(</span>
<span class="sd">                            {&quot;id&quot;: (1, 2), &quot;a&quot;: (1, 2), &quot;b&quot;: (-1, 12), &quot;weight&quot;: (1, 2)}</span>
<span class="sd">                        )</span>
<span class="sd">                    ).covars(),</span>
<span class="sd">                    Sample.from_frame(</span>
<span class="sd">                        pd.DataFrame(</span>
<span class="sd">                            {&quot;id&quot;: (1, 2), &quot;a&quot;: (3, 4), &quot;b&quot;: (0, 42), &quot;weight&quot;: (1, 2)}</span>
<span class="sd">                        )</span>
<span class="sd">                    ).covars(),</span>
<span class="sd">                )</span>

<span class="sd">                    # a             2.828427</span>
<span class="sd">                    # b             0.684659</span>
<span class="sd">                    # mean(asmd)    1.756543</span>
<span class="sd">                    # dtype: float64</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">BalanceDF</span><span class="o">.</span><span class="n">_check_if_not_BalanceDF</span><span class="p">(</span><span class="n">sample_BalanceDF</span><span class="p">,</span> <span class="s2">&quot;sample_BalanceDF&quot;</span><span class="p">)</span>
        <span class="n">BalanceDF</span><span class="o">.</span><span class="n">_check_if_not_BalanceDF</span><span class="p">(</span><span class="n">sample_BalanceDF</span><span class="p">,</span> <span class="s2">&quot;target_BalanceDF&quot;</span><span class="p">)</span>

        <span class="n">sample_df_values</span><span class="p">,</span> <span class="n">sample_weights</span> <span class="o">=</span> <span class="n">sample_BalanceDF</span><span class="o">.</span><span class="n">_get_df_and_weights</span><span class="p">()</span>
        <span class="n">target_df_values</span><span class="p">,</span> <span class="n">target_weights</span> <span class="o">=</span> <span class="n">target_BalanceDF</span><span class="o">.</span><span class="n">_get_df_and_weights</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">weighted_comparisons_stats</span><span class="o">.</span><span class="n">asmd</span><span class="p">(</span>
            <span class="n">sample_df_values</span><span class="p">,</span>
            <span class="n">target_df_values</span><span class="p">,</span>
            <span class="n">sample_weights</span><span class="p">,</span>
            <span class="n">target_weights</span><span class="p">,</span>
            <span class="n">std_type</span><span class="o">=</span><span class="s2">&quot;target&quot;</span><span class="p">,</span>
            <span class="n">aggregate_by_main_covar</span><span class="o">=</span><span class="n">aggregate_by_main_covar</span><span class="p">,</span>
        <span class="p">)</span>

<div class="viewcode-block" id="BalanceDF.asmd">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.asmd">[docs]</a>
    <span class="k">def</span> <span class="nf">asmd</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BalanceDF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">aggregate_by_main_covar</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;ASMD is the absolute difference of the means of two groups (say, P and T), divided by some standard deviation (std).</span>
<span class="sd">        It can be std of P or of T, or of P and T.</span>
<span class="sd">        These are all variations on the absolute value of cohen&#39;s d (see: https://en.wikipedia.org/wiki/Effect_size#Cohen&#39;s_d).</span>

<span class="sd">        We can use asmd to compares multiple Samples (with and without adjustment) to a target population.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object from sample (with/without adjustment, but it needs some target)</span>
<span class="sd">            on_linked_samples (bool, optional): If to compare also to linked sample objects (specifically: unadjusted), or not. Defaults to True.</span>
<span class="sd">            target (Optional[&quot;BalanceDF&quot;], optional): A BalanceDF (of the same type as the one used in self) to compare against.</span>
<span class="sd">                If None then it looks for a target in the self linked objects. Defaults to None.</span>
<span class="sd">            aggregate_by_main_covar (bool, optional): Defaults to False.</span>
<span class="sd">                If True, it will make sure to return the asmd DataFrame after averaging</span>
<span class="sd">                all the columns from using the one-hot encoding for categorical variables.</span>
<span class="sd">                See ::_aggregate_asmd_by_main_covar:: for more details.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError:</span>
<span class="sd">                If self has no target and no target is supplied.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame:</span>
<span class="sd">                If on_linked_samples is False, then only one row (index name depends on BalanceDF type, e.g.: covars), with asmd of self vs the target (depending if it&#39;s covars, or something else).</span>
<span class="sd">                If on_linked_samples is True, then two rows per source (self, unadjusted), each with the asmd compared to target, and a third row for the difference (self-unadjusted).</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                from copy import deepcopy</span>


<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                s3_null_madeup_weights = deepcopy(s3_null)</span>
<span class="sd">                s3_null_madeup_weights.set_weights((1, 2, 3, 1))</span>

<span class="sd">                print(s3_null.covars().asmd().round(3))</span>
<span class="sd">                    #                     a      b  c[v]   c[x]   c[y]   c[z]  mean(asmd)</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self               0.56  8.747   NaN  0.069  0.266  0.533       3.175</span>
<span class="sd">                    # unadjusted         0.56  8.747   NaN  0.069  0.266  0.533       3.175</span>
<span class="sd">                    # unadjusted - self  0.00  0.000   NaN  0.000  0.000  0.000       0.000</span>

<span class="sd">                # show that on_linked_samples = False works:</span>
<span class="sd">                print(s3_null.covars().asmd(on_linked_samples = False).round(3))</span>
<span class="sd">                    #            a      b  c[v]   c[x]   c[y]   c[z]  mean(asmd)</span>
<span class="sd">                    # index</span>
<span class="sd">                    # covars  0.56  8.747   NaN  0.069  0.266  0.533       3.175</span>

<span class="sd">                # verify this also works when we have some weights</span>
<span class="sd">                print(s3_null_madeup_weights.covars().asmd())</span>
<span class="sd">                    #                           a         b  c[v]  ...      c[y]      c[z]  mean(asmd)</span>
<span class="sd">                    # source                                       ...</span>
<span class="sd">                    # self               0.296500  8.153742   NaN  ...  0.000000  0.218218    2.834932</span>
<span class="sd">                    # unadjusted         0.560055  8.746742   NaN  ...  0.265606  0.533422    3.174566</span>
<span class="sd">                    # unadjusted - self  0.263555  0.592999   NaN  ...  0.265606  0.315204    0.33963</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">target_from_self</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="n">target_from_self</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="nb">object</span><span class="o">.</span><span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no target set, or target has no </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="si">}</span><span class="s2"> to compare against.&quot;</span>
            <span class="p">)</span>
        <span class="k">elif</span> <span class="n">on_linked_samples</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">balance_util</span><span class="o">.</span><span class="n">row_pairwise_diffs</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">_call_on_linked</span><span class="p">(</span>
                    <span class="s2">&quot;asmd&quot;</span><span class="p">,</span>
                    <span class="n">exclude</span><span class="o">=</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">,),</span>
                    <span class="n">target</span><span class="o">=</span><span class="n">target</span><span class="p">,</span>
                    <span class="n">aggregate_by_main_covar</span><span class="o">=</span><span class="n">aggregate_by_main_covar</span><span class="p">,</span>
                    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
                <span class="p">)</span>
            <span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">out</span> <span class="o">=</span> <span class="p">(</span>
                <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">_asmd_BalanceDF</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">,</span> <span class="n">aggregate_by_main_covar</span><span class="p">)</span>
                <span class="p">)</span>
                <span class="o">.</span><span class="n">transpose</span><span class="p">()</span>
                <span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="n">index</span><span class="o">=</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="p">,))</span>
                <span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s2">&quot;index&quot;</span><span class="p">)</span>
            <span class="p">)</span>
            <span class="k">return</span> <span class="n">out</span></div>


<div class="viewcode-block" id="BalanceDF.asmd_improvement">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.asmd_improvement">[docs]</a>
    <span class="k">def</span> <span class="nf">asmd_improvement</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">unadjusted</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BalanceDF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="s2">&quot;BalanceDF&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates the improvement in mean(asmd) from before to after applying some weight adjustment.</span>

<span class="sd">        See :func:`weighted_comparisons_stats.asmd_improvement` for details.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): BalanceDF (e.g.: of self after adjustment)</span>
<span class="sd">            unadjusted (Optional[&quot;BalanceDF&quot;], optional): BalanceDF (e.g.: of self before adjustment). Defaults to None.</span>
<span class="sd">            target (Optional[&quot;BalanceDF&quot;], optional): To compare against. Defaults to None.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If target is not linked in self and also not provided to the function.</span>
<span class="sd">            ValueError: If unadjusted is not linked in self and also not provided to the function.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.float64: The improvement is taking the (before_mean_asmd-after_mean_asmd)/before_mean_asmd.</span>
<span class="sd">                The asmd is calculated using :func:`asmd`.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                from copy import deepcopy</span>


<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;b&quot;: (4, 6, 8),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 1, 2),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>

<span class="sd">                s3_null_madeup_weights = deepcopy(s3_null)</span>
<span class="sd">                s3_null_madeup_weights.set_weights((1, 2, 3, 1))</span>

<span class="sd">                s3_null.covars().asmd_improvement() # 0. since unadjusted is just a copy of self</span>
<span class="sd">                s3_null_madeup_weights.covars().asmd_improvement() # 0.10698596233975825</span>

<span class="sd">                asmd_df = s3_null_madeup_weights.covars().asmd()</span>
<span class="sd">                print(asmd_df[&quot;mean(asmd)&quot;])</span>
<span class="sd">                    # source</span>
<span class="sd">                    # self                 2.834932</span>
<span class="sd">                    # unadjusted           3.174566</span>
<span class="sd">                    # unadjusted - self    0.339634</span>
<span class="sd">                    # Name: mean(asmd), dtype: float64</span>
<span class="sd">                (asmd_df[&quot;mean(asmd)&quot;][1] - asmd_df[&quot;mean(asmd)&quot;][0]) / asmd_df[&quot;mean(asmd)&quot;][1]  # 0.10698596233975825</span>
<span class="sd">                # just like asmd_improvement</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">unadjusted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">unadjusted</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;unadjusted&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">unadjusted</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="nb">object</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no unadjusted set or unadjusted has no </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;Sample </span><span class="si">{</span><span class="nb">object</span><span class="o">.</span><span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="p">)</span><span class="si">}</span><span class="s2"> has no target set or target has no </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">__name</span><span class="si">}</span><span class="s2">.&quot;</span>
            <span class="p">)</span>

        <span class="n">sample_before_df</span><span class="p">,</span> <span class="n">sample_before_weights</span> <span class="o">=</span> <span class="n">unadjusted</span><span class="o">.</span><span class="n">_get_df_and_weights</span><span class="p">()</span>
        <span class="n">sample_after_df</span><span class="p">,</span> <span class="n">sample_after_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_get_df_and_weights</span><span class="p">()</span>
        <span class="n">target_df</span><span class="p">,</span> <span class="n">target_weights</span> <span class="o">=</span> <span class="n">target</span><span class="o">.</span><span class="n">_get_df_and_weights</span><span class="p">()</span>

        <span class="k">return</span> <span class="n">weighted_comparisons_stats</span><span class="o">.</span><span class="n">asmd_improvement</span><span class="p">(</span>
            <span class="n">sample_before</span><span class="o">=</span><span class="n">sample_before_df</span><span class="p">,</span>
            <span class="n">sample_after</span><span class="o">=</span><span class="n">sample_after_df</span><span class="p">,</span>
            <span class="n">target</span><span class="o">=</span><span class="n">target_df</span><span class="p">,</span>
            <span class="n">sample_before_weights</span><span class="o">=</span><span class="n">sample_before_weights</span><span class="p">,</span>
            <span class="n">sample_after_weights</span><span class="o">=</span><span class="n">sample_after_weights</span><span class="p">,</span>
            <span class="n">target_weights</span><span class="o">=</span><span class="n">target_weights</span><span class="p">,</span>
        <span class="p">)</span></div>


    <span class="c1"># TODO: implement the following methods (probably first in balance.stats_and_plots.weighted_comparisons_stats)</span>
    <span class="c1"># def emd(self):</span>
    <span class="c1">#     return NotImplementedError()</span>

    <span class="c1"># def cvmd(self):</span>
    <span class="c1">#     return NotImplementedError()</span>

    <span class="c1"># def ks(self):</span>
    <span class="c1">#     return NotImplementedError()</span>

    <span class="k">def</span> <span class="nf">_df_with_ids</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Creates a DataFrame of the BalanceDF, with ids.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: DataFrame with id_column and then the df.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">((</span><span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="o">.</span><span class="n">id_column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

<div class="viewcode-block" id="BalanceDF.to_csv">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceDF.to_csv">[docs]</a>
    <span class="k">def</span> <span class="nf">to_csv</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceDF&quot;</span><span class="p">,</span>
        <span class="n">path_or_buf</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">FilePathOrBuffer</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="o">*</span><span class="n">args</span><span class="p">,</span>
        <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Write df with ids from BalanceDF to a comma-separated values (csv) file.</span>

<span class="sd">        Uses :func:`pd.DataFrame.to_csv`.</span>

<span class="sd">        If an &#39;index&#39; argument is not provided then it defaults to False.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceDF): Object.</span>
<span class="sd">            path_or_buf (Optional[FilePathOrBuffer], optional): location where to save the csv.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[str]: If path_or_buf is None, returns the resulting csv format as a string. Otherwise returns None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="s2">&quot;index&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">kwargs</span><span class="p">:</span>
            <span class="n">kwargs</span><span class="p">[</span><span class="s2">&quot;index&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_df_with_ids</span><span class="p">()</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">path_or_buf</span><span class="o">=</span><span class="n">path_or_buf</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span></div>
</div>



<div class="viewcode-block" id="BalanceOutcomesDF">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceOutcomesDF">[docs]</a>
<span class="k">class</span> <span class="nc">BalanceOutcomesDF</span><span class="p">(</span><span class="n">BalanceDF</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceOutcomesDF&quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="n">Sample</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A factory function to create BalanceOutcomesDF</span>

<span class="sd">        This is used through :func:`Sample.outcomes`.</span>
<span class="sd">        It initiates a BalanceOutcomesDF object by passing the relevant arguments to</span>
<span class="sd">        :func:`BalanceDF.__init__`.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceOutcomesDF): Object that is initiated.</span>
<span class="sd">            sample (Sample): Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">_outcome_columns</span><span class="p">,</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;outcomes&quot;</span><span class="p">)</span>

    <span class="c1"># TODO: add the `relative_to` argument (with options &#39;self&#39; and &#39;target&#39;)</span>
    <span class="c1">#       this will also require to update _relative_response_rates a bit.</span>
<div class="viewcode-block" id="BalanceOutcomesDF.relative_response_rates">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceOutcomesDF.relative_response_rates">[docs]</a>
    <span class="k">def</span> <span class="nf">relative_response_rates</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceOutcomesDF&quot;</span><span class="p">,</span>
        <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">bool</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
        <span class="n">per_column</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produces a summary table of number of responses and proportion of completed responses.</span>

<span class="sd">        See :func:`general_stats.relative_response_rates`.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceOutcomesDF): Object</span>
<span class="sd">            target (Union[bool, pd.DataFrame], optional): Defaults to False.</span>
<span class="sd">                Determines what is passed to df_target in :func:`general_stats.relative_response_rates`</span>
<span class="sd">                If False: passes None.</span>
<span class="sd">                If True: passes the df from the target of sample (notice, it&#39;s the df of target, NOT target.outcome().df).</span>
<span class="sd">                    So it means it will count only rows that are all notnull rows (so if the target has covars and outcomes,</span>
<span class="sd">                        both will need to be notnull to be counted).</span>
<span class="sd">                    If you want to control this in a more specific way, pass pd.DataFrame instead.</span>
<span class="sd">                If pd.DataFrame: passes it as is.</span>
<span class="sd">            per_column (bool, optional): Default is False. See :func:`general_stats.relative_response_rates`.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[pd.DataFrame]: A column per outcome, and two rows.</span>
<span class="sd">                One row with number of non-null observations, and</span>
<span class="sd">                A second row with the proportion of non-null observations.</span>

<span class="sd">                If &#39;target&#39; is set to True but there is no target, the function returns None.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                from balance.sample_class import Sample</span>


<span class="sd">                s_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame({&quot;o1&quot;: (7, 8, 9, 10), &quot;o2&quot;: (7, 8, 9, np.nan), &quot;id&quot;: (1, 2, 3, 4)}),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>

<span class="sd">                print(s_o.outcomes().relative_response_rates())</span>
<span class="sd">                    #       o1    o2</span>
<span class="sd">                    # n    4.0   3.0</span>
<span class="sd">                    # %  100.0  75.0</span>

<span class="sd">                s_o.outcomes().relative_response_rates(target = True)</span>
<span class="sd">                # None</span>

<span class="sd">                # compared with a larger target</span>

<span class="sd">                t_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;o1&quot;: (7, 8, 9, 10, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;o2&quot;: (7, 8, 9, np.nan, np.nan, 12, 13, 14),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4, 5, 6, 7, 8),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>
<span class="sd">                s_o2 = s_o.set_target(t_o)</span>

<span class="sd">                print(s_o2.outcomes().relative_response_rates(True, per_column = True))</span>
<span class="sd">                    #     o1    o2</span>
<span class="sd">                    # n   4.0   3.0</span>
<span class="sd">                    # %  50.0  50.0</span>

<span class="sd">                df_target = pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;o1&quot;: (7, 8, 9, 10, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;o2&quot;: (7, 8, 9, np.nan, np.nan, 12, 13, 14),</span>
<span class="sd">                        }</span>
<span class="sd">                    )</span>

<span class="sd">                print(s_o2.outcomes().relative_response_rates(target = df_target, per_column = True))</span>
<span class="sd">                    #     o1    o2</span>
<span class="sd">                    # n   4.0   3.0</span>
<span class="sd">                    # %  50.0  50.0</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">target</span><span class="p">)</span> <span class="ow">is</span> <span class="nb">bool</span><span class="p">:</span>
            <span class="c1"># Then: get target from self:</span>
            <span class="k">if</span> <span class="n">target</span><span class="p">:</span>
                <span class="n">self_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">self_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
                    <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Sample does not have target set&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">None</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">df_target</span> <span class="o">=</span> <span class="n">self_target</span><span class="o">.</span><span class="n">df</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">df_target</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">df_target</span> <span class="o">=</span> <span class="n">target</span>

        <span class="k">return</span> <span class="n">general_stats</span><span class="o">.</span><span class="n">relative_response_rates</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="p">,</span> <span class="n">df_target</span><span class="p">,</span> <span class="n">per_column</span><span class="o">=</span><span class="n">per_column</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="BalanceOutcomesDF.target_response_rates">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceOutcomesDF.target_response_rates">[docs]</a>
    <span class="k">def</span> <span class="nf">target_response_rates</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceOutcomesDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates relative_response_rates for the target in a Sample object.</span>

<span class="sd">        See :func:`general_stats.relative_response_rates`.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceOutcomesDF): Object (with/without a target set)</span>

<span class="sd">        Returns:</span>
<span class="sd">            Optional[pd.DataFrame]: None if the object doesn&#39;t have a target.</span>
<span class="sd">                If the object has a target, it returns the output of :func:`general_stats.relative_response_rates`.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                from balance.sample_class import Sample</span>


<span class="sd">                s_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame({&quot;o1&quot;: (7, 8, 9, 10), &quot;o2&quot;: (7, 8, 9, np.nan), &quot;id&quot;: (1, 2, 3, 4)}),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>

<span class="sd">                t_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;o1&quot;: (7, 8, 9, 10, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;o2&quot;: (7, 8, 9, np.nan, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4, 5, 6, 7, 8),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>
<span class="sd">                s_o = s_o.set_target(t_o)</span>

<span class="sd">                print(s_o.outcomes().target_response_rates())</span>
<span class="sd">                    #       o1    o2</span>
<span class="sd">                    # n    8.0   7.0</span>
<span class="sd">                    # %  100.0  87.5</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">self_target</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_BalanceDF_child_from_linked_samples</span><span class="p">()</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;target&quot;</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">self_target</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Sample does not have target set&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">general_stats</span><span class="o">.</span><span class="n">relative_response_rates</span><span class="p">(</span><span class="n">self_target</span><span class="o">.</span><span class="n">df</span><span class="p">)</span></div>


    <span class="c1"># TODO: it&#39;s a question if summary should produce a printable output or a DataFrame.</span>
    <span class="c1">#       The BalanceDF.summary method only returns a DataFrame. So it&#39;s a question</span>
    <span class="c1">#       what is the best way to structure this more generally.</span>
<div class="viewcode-block" id="BalanceOutcomesDF.summary">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceOutcomesDF.summary">[docs]</a>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceOutcomesDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Produces summary printable string of a BalanceOutcomesDF object.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceOutcomesDF): Object.</span>
<span class="sd">            on_linked_samples (Optional[bool]): Ignored. Only here since summary overrides BalanceDF.summary.</span>

<span class="sd">        Returns:</span>
<span class="sd">            str: A printable string, with mean of outcome variables and response rates.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>

<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame({&quot;o1&quot;: (7, 8, 9, 10), &quot;o2&quot;: (7, 8, 9, np.nan), &quot;id&quot;: (1, 2, 3, 4)}),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>

<span class="sd">                t_o = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;o1&quot;: (7, 8, 9, 10, 11, 12, 13, 14),</span>
<span class="sd">                            &quot;o2&quot;: (7, 8, 9, np.nan, np.nan, 12, 13, 14),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4, 5, 6, 7, 8),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    outcome_columns=(&quot;o1&quot;, &quot;o2&quot;),</span>
<span class="sd">                )</span>
<span class="sd">                s_o2 = s_o.set_target(t_o)</span>

<span class="sd">                print(s_o.outcomes().summary())</span>
<span class="sd">                    # 2 outcomes: [&#39;o1&#39; &#39;o2&#39;]</span>
<span class="sd">                    # Mean outcomes (with 95% confidence intervals):</span>
<span class="sd">                    # source            self             self</span>
<span class="sd">                    # _is_na_o2[False]  0.75   (0.326, 1.174)</span>
<span class="sd">                    # _is_na_o2[True]   0.25  (-0.174, 0.674)</span>
<span class="sd">                    # o1                8.50   (7.404, 9.596)</span>
<span class="sd">                    # o2                6.00   (2.535, 9.465)</span>

<span class="sd">                    # Response rates (relative to number of respondents in sample):</span>
<span class="sd">                    #       o1    o2</span>
<span class="sd">                    # n    4.0   3.0</span>
<span class="sd">                    # %  100.0  75.0</span>

<span class="sd">                print(s_o2.outcomes().summary())</span>
<span class="sd">                    # 2 outcomes: [&#39;o1&#39; &#39;o2&#39;]</span>
<span class="sd">                    # Mean outcomes (with 95% confidence intervals):</span>
<span class="sd">                    # source            self  target             self           target</span>
<span class="sd">                    # _is_na_o2[False]  0.75   0.750   (0.326, 1.174)     (0.45, 1.05)</span>
<span class="sd">                    # _is_na_o2[True]   0.25   0.250  (-0.174, 0.674)    (-0.05, 0.55)</span>
<span class="sd">                    # o1                8.50  10.500   (7.404, 9.596)  (8.912, 12.088)</span>
<span class="sd">                    # o2                6.00   7.875   (2.535, 9.465)  (4.351, 11.399)</span>

<span class="sd">                    # Response rates (relative to number of respondents in sample):</span>
<span class="sd">                    #       o1    o2</span>
<span class="sd">                    # n    4.0   3.0</span>
<span class="sd">                    # %  100.0  75.0</span>
<span class="sd">                    # Response rates (relative to notnull rows in the target):</span>
<span class="sd">                    #            o1    o2</span>
<span class="sd">                    # n   4.000000   3.0</span>
<span class="sd">                    # %  66.666667  50.0</span>
<span class="sd">                    # Response rates (in the target):</span>
<span class="sd">                    #        o1    o2</span>
<span class="sd">                    # n    8.0   6.0</span>
<span class="sd">                    # %  100.0  75.0</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">mean_outcomes_with_ci</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mean_with_ci</span><span class="p">()</span>
        <span class="n">relative_response_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_response_rates</span><span class="p">()</span>
        <span class="n">target_response_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_response_rates</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">target_response_rates</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">target_clause</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="n">relative_to_target_clause</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">relative_to_target_response_rates</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">relative_response_rates</span><span class="p">(</span>
                <span class="n">target</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">per_column</span><span class="o">=</span><span class="kc">False</span>
            <span class="p">)</span>
            <span class="n">relative_to_target_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Response rates (relative to notnull rows in the target):</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">relative_to_target_response_rates</span><span class="si">}</span><span class="s2">&quot;</span>

            <span class="n">target_clause</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;Response rates (in the target):</span><span class="se">\n</span><span class="s2"> </span><span class="si">{</span><span class="n">target_response_rates</span><span class="si">}</span><span class="s2">&quot;</span>

        <span class="n">n_outcomes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
        <span class="n">list_outcomes</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">values</span>
        <span class="n">mean_outcomes_with_ci</span> <span class="o">=</span> <span class="n">mean_outcomes_with_ci</span>
        <span class="n">relative_response_rates</span> <span class="o">=</span> <span class="n">relative_response_rates</span>
        <span class="n">target_clause</span> <span class="o">=</span> <span class="n">target_clause</span>

        <span class="n">out</span> <span class="o">=</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">n_outcomes</span><span class="si">}</span><span class="s2"> outcomes: </span><span class="si">{</span><span class="n">list_outcomes</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;Mean outcomes (with 95% confidence intervals):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="c1"># TODO: in the future consider if to add an argument to transpose (.T) the output, in case there are multiple outcomes.</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">mean_outcomes_with_ci</span><span class="o">.</span><span class="n">to_string</span><span class="p">(</span><span class="n">max_cols</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span>
            <span class="s2">&quot;Response rates (relative to number of respondents in sample):</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relative_response_rates</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">relative_to_target_clause</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
            <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">target_clause</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">out</span></div>
</div>



<div class="viewcode-block" id="BalanceCovarsDF">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceCovarsDF">[docs]</a>
<span class="k">class</span> <span class="nc">BalanceCovarsDF</span><span class="p">(</span><span class="n">BalanceDF</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceCovarsDF&quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="n">Sample</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A factory function to create BalanceCovarsDF</span>

<span class="sd">        This is used through :func:`Sample.covars`.</span>
<span class="sd">        It initiates a BalanceCovarsDF object by passing the relevant arguments to</span>
<span class="sd">        :func:`BalanceDF.__init__`.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceCovarsDF): Object that is initiated.</span>
<span class="sd">            sample (Sample): Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">_covar_columns</span><span class="p">(),</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;covars&quot;</span><span class="p">)</span>

<div class="viewcode-block" id="BalanceCovarsDF.from_frame">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceCovarsDF.from_frame">[docs]</a>
    <span class="k">def</span> <span class="nf">from_frame</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceCovarsDF&quot;</span><span class="p">,</span>
        <span class="n">df</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
        <span class="n">weights</span><span class="o">=</span><span class="n">Optional</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="s2">&quot;BalanceCovarsDF&quot;</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A factory function to create a BalanceCovarsDF from a df.</span>

<span class="sd">        Although generally the main way the object is created is through the __init__ method.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceCovarsDF): Object</span>
<span class="sd">            df (pd.DataFrame): A df.</span>
<span class="sd">            weights (Optional[pd.Series], optional): _description_. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            BalanceCovarsDF: Object.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># pyre-fixme[9]: df has type `DataFrame`; used as `Optional[DataFrame]`.</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">()</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">),</span> <span class="n">weights</span><span class="p">),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span>
        <span class="p">)</span>
        <span class="k">return</span> <span class="n">Sample</span><span class="o">.</span><span class="n">from_frame</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">id_column</span><span class="o">=</span><span class="s2">&quot;id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">covars</span><span class="p">()</span></div>
</div>



<div class="viewcode-block" id="BalanceWeightsDF">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceWeightsDF">[docs]</a>
<span class="k">class</span> <span class="nc">BalanceWeightsDF</span><span class="p">(</span><span class="n">BalanceDF</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">,</span> <span class="n">sample</span><span class="p">:</span> <span class="n">Sample</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A factory function to create BalanceWeightsDF</span>

<span class="sd">        This is used through :func:`Sample.weights`.</span>
<span class="sd">        It initiates a BalanceWeightsDF object by passing the relevant arguments to</span>
<span class="sd">        :func:`BalanceDF.__init__`.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): Object that is initiated.</span>
<span class="sd">            sample (Sample): Object</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">sample</span><span class="o">.</span><span class="n">weight_column</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(),</span> <span class="n">sample</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;weights&quot;</span><span class="p">)</span>

    <span class="c1"># TODO: maybe add better control if there are no weights for unadjusted or target (the current default shows them in the legend, but not in the figure)</span>
<div class="viewcode-block" id="BalanceWeightsDF.plot">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceWeightsDF.plot">[docs]</a>
    <span class="k">def</span> <span class="nf">plot</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="n">List</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">],</span> <span class="kc">None</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Plots kde (kernal density estimation) of the weights in a BalanceWeightsDF object using seaborn (as default).</span>

<span class="sd">        It&#39;s possible to use other plots using dist_type with arguments such as &quot;hist&quot;, &quot;kde&quot; (default), &quot;qq&quot;, and &quot;ecdf&quot;.</span>
<span class="sd">        Look at :func:`plot_dist` for more details.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): a BalanceOutcomesDF object, with a set of variables.</span>
<span class="sd">            on_linked_samples (bool, optional): Determines if the linked samples should be included in the plot.</span>
<span class="sd">                Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[Union[List, np.ndarray], Dict[str, go.Figure], None]:</span>
<span class="sd">                If library=&quot;plotly&quot; then returns a dictionary containing plots if return_dict_of_figures is True. None otherwise.</span>
<span class="sd">                If library=&quot;seaborn&quot; then returns None, unless return_axes is True. Then either a list or an np.array of matplotlib axis.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import numpy as np</span>
<span class="sd">                import pandas as pd</span>
<span class="sd">                from numpy import random</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                random.seed(96483)</span>

<span class="sd">                df = pd.DataFrame({</span>
<span class="sd">                    &quot;id&quot;: range(100),</span>
<span class="sd">                    &#39;v1&#39;: random.random_integers(11111, 11114, size=100).astype(str),</span>
<span class="sd">                    &#39;v2&#39;: random.normal(size = 100),</span>
<span class="sd">                    &#39;v3&#39;: random.uniform(size = 100),</span>
<span class="sd">                    &quot;w&quot;: pd.Series(np.ones(99).tolist() + [1000]),</span>
<span class="sd">                }).sort_values(by=[&#39;v2&#39;])</span>

<span class="sd">                s1 = Sample.from_frame(df,</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=[&quot;v1&quot;, &quot;v2&quot;],</span>
<span class="sd">                )</span>

<span class="sd">                s2 = Sample.from_frame(</span>
<span class="sd">                    df.assign(w = pd.Series(np.ones(100))),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=[&quot;v1&quot;, &quot;v2&quot;],</span>
<span class="sd">                )</span>

<span class="sd">                s3 = s1.set_target(s2)</span>
<span class="sd">                s3_null = s3.adjust(method=&quot;null&quot;)</span>
<span class="sd">                s3_null.set_weights(random.random(size = 100) + 0.5)</span>

<span class="sd">                # default: seaborn with dist_type = &quot;kde&quot;</span>
<span class="sd">                s3_null.weights().plot()</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">default_kwargs</span> <span class="o">=</span> <span class="p">{</span>
            <span class="s2">&quot;weighted&quot;</span><span class="p">:</span> <span class="kc">False</span><span class="p">,</span>
            <span class="s2">&quot;library&quot;</span><span class="p">:</span> <span class="s2">&quot;seaborn&quot;</span><span class="p">,</span>
            <span class="s2">&quot;dist_type&quot;</span><span class="p">:</span> <span class="s2">&quot;kde&quot;</span><span class="p">,</span>
            <span class="s2">&quot;numeric_n_values_threshold&quot;</span><span class="p">:</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="p">}</span>
        <span class="n">default_kwargs</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">on_linked_samples</span><span class="o">=</span><span class="n">on_linked_samples</span><span class="p">,</span> <span class="o">**</span><span class="n">default_kwargs</span><span class="p">)</span></div>


<div class="viewcode-block" id="BalanceWeightsDF.design_effect">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceWeightsDF.design_effect">[docs]</a>
    <span class="k">def</span> <span class="nf">design_effect</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">np</span><span class="o">.</span><span class="n">float64</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Calculates Kish&#39;s design effect (deff) on the BalanceWeightsDF weights.</span>

<span class="sd">        Extract the first column to get a pd.Series of the weights.</span>

<span class="sd">        See :func:`weights_stats.design_effect` for details.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): Object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            np.float64: Deff.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">weights_stats</span><span class="o">.</span><span class="n">design_effect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">])</span></div>


    <span class="c1"># TODO: in the future, consider if this type of overriding is the best solution.</span>
    <span class="c1">#       to reconsider as part of a larger code refactoring.</span>
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;A BalanceWeightsDF has no weights (its df is that of the weights.)</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): Object.</span>

<span class="sd">        Returns:</span>
<span class="sd">            NoneType: None.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="kc">None</span>

<div class="viewcode-block" id="BalanceWeightsDF.trim">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceWeightsDF.trim">[docs]</a>
    <span class="k">def</span> <span class="nf">trim</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">,</span>
        <span class="n">ratio</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">percentile</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">keep_sum_of_weights</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Trim weights in the sample object.</span>

<span class="sd">        Uses :func:`adjustments.trim_weights` for the weights trimming.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): Object.</span>
<span class="sd">            ratio (Optional[Union[float, int]], optional): Maps to weight_trimming_mean_ratio. Defaults to None.</span>
<span class="sd">            percentile (Optional[float], optional): Maps to weight_trimming_percentile. Defaults to None.</span>
<span class="sd">            keep_sum_of_weights (bool, optional): Maps to weight_trimming_percentile. Defaults to True.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None. This function updates the :func:`_sample` using :func:`set_weights`</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># TODO: verify which object exactly gets updated - and explain it here.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">_sample</span><span class="o">.</span><span class="n">set_weights</span><span class="p">(</span>
            <span class="n">trim_weights</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">],</span>
                <span class="n">weight_trimming_mean_ratio</span><span class="o">=</span><span class="n">ratio</span><span class="p">,</span>
                <span class="n">weight_trimming_percentile</span><span class="o">=</span><span class="n">percentile</span><span class="p">,</span>
                <span class="n">keep_sum_of_weights</span><span class="o">=</span><span class="n">keep_sum_of_weights</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span></div>


<div class="viewcode-block" id="BalanceWeightsDF.summary">
<a class="viewcode-back" href="../../balance.balancedf_class.html#balance.balancedf_class.BalanceWeightsDF.summary">[docs]</a>
    <span class="k">def</span> <span class="nf">summary</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">:</span> <span class="s2">&quot;BalanceWeightsDF&quot;</span><span class="p">,</span> <span class="n">on_linked_samples</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="nb">bool</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generates a summary of a BalanceWeightsDF object.</span>

<span class="sd">        This function provides a comprehensive overview of the BalanceWeightsDF object</span>
<span class="sd">        by calculating and returning a range of weight diagnostics.</span>

<span class="sd">        Args:</span>
<span class="sd">            self (BalanceWeightsDF): The BalanceWeightsDF object to be summarized.</span>
<span class="sd">            on_linked_samples (Optional[bool], optional): This parameter is ignored. It is only included</span>
<span class="sd">                because summary overrides BalanceDF.summary. Defaults to None.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing various weight diagnostics such as &#39;design_effect&#39;,</span>
<span class="sd">                &#39;effective_sample_proportion&#39;, &#39;effective_sample_size&#39;, sum of weights, and basic summary statistics</span>
<span class="sd">                from describe, &#39;nonparametric_skew&#39;, and &#39;weighted_median_breakdown_point&#39; among others.</span>

<span class="sd">        Note:</span>
<span class="sd">            The weights are normalized to sum to the sample size, n.</span>

<span class="sd">        Examples:</span>
<span class="sd">            ::</span>

<span class="sd">                import pandas as pd</span>
<span class="sd">                from balance.sample_class import Sample</span>

<span class="sd">                s1 = Sample.from_frame(</span>
<span class="sd">                    pd.DataFrame(</span>
<span class="sd">                        {</span>
<span class="sd">                            &quot;a&quot;: (1, 2, 3, 1),</span>
<span class="sd">                            &quot;b&quot;: (-42, 8, 2, -42),</span>
<span class="sd">                            &quot;o&quot;: (7, 8, 9, 10),</span>
<span class="sd">                            &quot;c&quot;: (&quot;x&quot;, &quot;y&quot;, &quot;z&quot;, &quot;v&quot;),</span>
<span class="sd">                            &quot;id&quot;: (1, 2, 3, 4),</span>
<span class="sd">                            &quot;w&quot;: (0.5, 2, 1, 1),</span>
<span class="sd">                        }</span>
<span class="sd">                    ),</span>
<span class="sd">                    id_column=&quot;id&quot;,</span>
<span class="sd">                    weight_column=&quot;w&quot;,</span>
<span class="sd">                    outcome_columns=&quot;o&quot;,</span>
<span class="sd">                )</span>

<span class="sd">                print(s1.weights().summary().round(2))</span>
<span class="sd">                    #                                 var   val</span>
<span class="sd">                    # 0                     design_effect  1.23</span>
<span class="sd">                    # 1       effective_sample_proportion  0.81</span>
<span class="sd">                    # 2             effective_sample_size  3.24</span>
<span class="sd">                    # 3                               sum  4.50</span>
<span class="sd">                    # 4                    describe_count  4.00</span>
<span class="sd">                    # 5                     describe_mean  1.00</span>
<span class="sd">                    # 6                      describe_std  0.56</span>
<span class="sd">                    # 7                      describe_min  0.44</span>
<span class="sd">                    # 8                      describe_25%  0.78</span>
<span class="sd">                    # 9                      describe_50%  0.89</span>
<span class="sd">                    # 10                     describe_75%  1.11</span>
<span class="sd">                    # 11                     describe_max  1.78</span>
<span class="sd">                    # 12                    prop(w &lt; 0.1)  0.00</span>
<span class="sd">                    # 13                    prop(w &lt; 0.2)  0.00</span>
<span class="sd">                    # 14                  prop(w &lt; 0.333)  0.00</span>
<span class="sd">                    # 15                    prop(w &lt; 0.5)  0.25</span>
<span class="sd">                    # 16                      prop(w &lt; 1)  0.75</span>
<span class="sd">                    # 17                     prop(w &gt;= 1)  0.25</span>
<span class="sd">                    # 18                     prop(w &gt;= 2)  0.00</span>
<span class="sd">                    # 19                     prop(w &gt;= 3)  0.00</span>
<span class="sd">                    # 20                     prop(w &gt;= 5)  0.00</span>
<span class="sd">                    # 21                    prop(w &gt;= 10)  0.00</span>
<span class="sd">                    # 22               nonparametric_skew  0.20</span>
<span class="sd">                    # 23  weighted_median_breakdown_point  0.25</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># ----------------------------------------------------</span>
        <span class="c1"># Diagnostics on the weights</span>
        <span class="c1"># ----------------------------------------------------</span>
        <span class="n">the_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">df</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span>
            <span class="p">:,</span> <span class="mi">0</span>
        <span class="p">]</span>  <span class="c1"># should be [&#39;weight&#39;], but this is more robust in case a user uses other names</span>
        <span class="n">weights_diag_var</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">weights_diag_value</span> <span class="o">=</span> <span class="p">[]</span>

        <span class="c1"># adding design_effect and variations</span>
        <span class="n">the_weights_de</span> <span class="o">=</span> <span class="n">weights_stats</span><span class="o">.</span><span class="n">design_effect</span><span class="p">(</span><span class="n">the_weights</span><span class="p">)</span>
        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="s2">&quot;design_effect&quot;</span><span class="p">,</span> <span class="s2">&quot;effective_sample_proportion&quot;</span><span class="p">,</span> <span class="s2">&quot;effective_sample_size&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="p">[</span><span class="n">the_weights_de</span><span class="p">,</span> <span class="mi">1</span> <span class="o">/</span> <span class="n">the_weights_de</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">the_weights</span><span class="p">)</span> <span class="o">/</span> <span class="n">the_weights_de</span><span class="p">]</span>
        <span class="p">)</span>

        <span class="c1"># adding sum of weights, and then normalizing them to n (sample size)</span>
        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;sum&quot;</span><span class="p">)</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">the_weights</span><span class="o">.</span><span class="n">sum</span><span class="p">())</span>

        <span class="n">the_weights</span> <span class="o">=</span> <span class="n">the_weights</span> <span class="o">/</span> <span class="n">the_weights</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># normalize weights to sum to n.</span>

        <span class="c1"># adding basic summary statistics from describe:</span>
        <span class="n">tmp_describe</span> <span class="o">=</span> <span class="n">the_weights</span><span class="o">.</span><span class="n">describe</span><span class="p">()</span>
        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">extend</span><span class="p">([</span><span class="s2">&quot;describe_&quot;</span> <span class="o">+</span> <span class="n">i</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">tmp_describe</span><span class="o">.</span><span class="n">index</span><span class="p">])</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">tmp_describe</span><span class="o">.</span><span class="n">to_list</span><span class="p">())</span>
        <span class="c1"># TODO: decide if we want more quantiles of the weights.</span>

        <span class="c1"># adding prop_above_and_below</span>
        <span class="n">tmp_props</span> <span class="o">=</span> <span class="n">weights_stats</span><span class="o">.</span><span class="n">prop_above_and_below</span><span class="p">(</span><span class="n">the_weights</span><span class="p">)</span>
        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">tmp_props</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>  <span class="c1"># pyre-ignore[16]: existing defaults make sure this output is pd.Series with relevant methods.</span>
        <span class="p">)</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span>
            <span class="n">tmp_props</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>  <span class="c1"># pyre-ignore[16]: existing defaults make sure this output is pd.Series with relevant methods.</span>
        <span class="p">)</span>
        <span class="c1"># TODO: decide if we want more numbers (e.g.: 2/3 and 3/2)</span>

        <span class="c1"># adding nonparametric_skew and weighted_median_breakdown_point</span>
        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;nonparametric_skew&quot;</span><span class="p">)</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">weights_stats</span><span class="o">.</span><span class="n">nonparametric_skew</span><span class="p">(</span><span class="n">the_weights</span><span class="p">))</span>

        <span class="n">weights_diag_var</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;weighted_median_breakdown_point&quot;</span><span class="p">)</span>
        <span class="n">weights_diag_value</span><span class="o">.</span><span class="n">append</span><span class="p">(</span>
            <span class="n">weights_stats</span><span class="o">.</span><span class="n">weighted_median_breakdown_point</span><span class="p">(</span><span class="n">the_weights</span><span class="p">)</span>
        <span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
            <span class="p">{</span>
                <span class="c1"># &quot;metric&quot;: &quot;weights_diagnostics&quot;,</span>
                <span class="s2">&quot;var&quot;</span><span class="p">:</span> <span class="n">weights_diag_var</span><span class="p">,</span>
                <span class="s2">&quot;val&quot;</span><span class="p">:</span> <span class="n">weights_diag_value</span><span class="p">,</span>
            <span class="p">}</span>
        <span class="p">)</span></div>
</div>

</pre></div>

            <div class="clearer"></div>
          </div>
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related" role="navigation" aria-label="related navigation">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li class="nav-item nav-item-0"><a href="../../index.html">balance  documentation</a> &#187;</li>
          <li class="nav-item nav-item-1"><a href="../index.html" >Module code</a> &#187;</li>
          <li class="nav-item nav-item-2"><a href="../balance.html" >balance</a> &#187;</li>
        <li class="nav-item nav-item-this"><a href="">balance.balancedf_class</a></li> 
      </ul>
    </div>
    <div class="footer" role="contentinfo">
    </div>
  </body>
</html>